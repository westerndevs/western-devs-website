<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Writing Custom Commands for DNX With ASP.NET 5.0 | Western Devs</title>
  <meta name="description" content="If you are a developer on the .NET stack, you&#39;ve now got access to a great new extension to your development environment. DNX, or the .NET Execution Environment, is a powerful new extensibility point">
<meta property="og:type" content="article">
<meta property="og:title" content="Writing Custom Commands for DNX With ASP.NET 5.0">
<meta property="og:url" content="https://westerndevs.com/_/writing-custom-commands-for-dnx-with-asp-net-5-0/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="If you are a developer on the .NET stack, you&#39;ve now got access to a great new extension to your development environment. DNX, or the .NET Execution Environment, is a powerful new extensibility point">
<meta property="og:image" content="http://jameschambers.com/wp-content/uploads/2015/08/image_thumb2.png">
<meta property="og:image" content="https://jcblogimages.blob.core.windows.net/img/2015/08/wlEmoticon-smile1.png">
<meta property="article:published_time" content="2015-08-14T01:50:41.000Z">
<meta property="article:modified_time" content="2024-09-02T18:35:42.376Z">
<meta property="article:author" content="Western Devs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://jameschambers.com/wp-content/uploads/2015/08/image_thumb2.png">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
    <link rel="canonical" href="http://jameschambers.com/2015/08/writing-custom-commands-for-dnx-with-asp-net-5-0/">
  
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.1"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">AUG</div>
    <div class="ListLrgDateDay">14</div>
    <div class="ListLrgDateYear">2015</div>
  </div>
  <h2>Writing Custom Commands for DNX With ASP.NET 5.0</h2>
</div>

		    

<p class="TXTsm">ORIGINALLY POSTED TO: <a href="http://jameschambers.com/2015/08/writing-custom-commands-for-dnx-with-asp-net-5-0/" target="_blank" rel="noopener" class='originalurl'>http://jameschambers.com/2015/08/writing-custom-commands-for-dnx-with-asp-net-5-0/</a></p>



			<div id="mainPostContent">
	        <p>If you are a developer on the .NET stack, you've now got access to a great new extension to your development environment. DNX, or the .NET Execution Environment, is a powerful new extensibility point that you can leverage to build project extensions, cross-platform utilities, build-time extensions and support for automation. In this article I'll walk you through the process of building your own custom DNX command on top of ASP.NET 5.0.</p>
<a id="more"></a>
<h2>Where You've Seen It</h2>
<p>DNX has the ability to scan a project.json and look for commands that you install as packages or that you create yourself. If you've started following the examples of the MVC Framework or perhaps with Entity Framework, you may have seen things like this in your project.json:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"commands"</span>: &#123;</span><br><span class="line">  <span class="string">"web"</span>: <span class="string">"Microsoft.AspNet.Hosting --config hosting.ini"</span>,</span><br><span class="line">  <span class="string">"ef"</span>: <span class="string">"EntityFramework.Commands"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="http://jameschambers.com/wp-content/uploads/2015/08/image_thumb2.png" class="pull-right">
<p>These entries are here so that DNX understands the alias you assign (such as &quot;web&quot; or &quot;ef&quot;) and how it maps to an assembly that you've created or taken on as a dependency.  The EF reference is quite straightforward above, simply saying that any call to &quot;ef&quot; via DNX will go into the entry point in EntityFramework.Commands.  You would invoke that as follows from the directory of your <em>project</em>:</p>
<pre><code>dnx . ef
</code></pre>
<p>All parameters that are passed in are available to you as well, so if you were to instead use:</p>
<pre><code>dnx . ef help migration
</code></pre>
<p>Then EF would be getting the params &quot;help migrations&quot; to parse and process. As can be clearly seen in the &quot;web&quot; alias, you can also specify defaults that get passed into the command when it is executed, thus, the call to web in the above project.json passes in the path and filename of the configuration file to be used when starting IIS express.</p>
<p>There is no special meaning to &quot;ef&quot; or &quot;web&quot;. These are just names that you assign so that the correct mapping can be made. If you changed &quot;ef&quot; to &quot;right-said-fred&quot; you would be able to run migrations from the command line like so:</p>
<pre><code>dnx . right-said-fred migration add too-sexy
</code></pre>
<p>Great! So you can create commands, pass in parameters and share these commands through the project.json file. But now what?</p>
<h2>Now What?</h2>
<p>I'm so glad you asked!</p>
<p>So far things really aren't too different from any other console app you might create. I mean, you can parse args and do whatever you like in those apps as well.</p>
<p>But here's the winner-winner-chicken-dinner bits: did you notice the &quot;.&quot; that is passed into DNX? That is actually the path to the project.json file, and this is important.</p>
<blockquote>
<p><strong>Important Note</strong>: From beta 7 onward (or already if you're on the nightly builds) DNX will implicitly run with an appbase of the current directory, removing the need for the &quot;.&quot; in the command. I'll try to remember to come back to this post to correct that when beta 7 is out in the wild. Read more about the change on the <a href="https://github.com/aspnet/Announcements/issues/52" target="_blank" rel="noopener">ASP.NET Announcement repo</a> on GitHub.</p>
</blockquote>
<p>DNX doesn't actually do a lot on its own, not other than providing an execution context under which you can run your commands. But this is a good thing! By passing in the path to a project.json, you feed DNX the command mappings that you want to use, and in turn, DNX provides you with all of the benefits of running inside of the ASP.NET 5.0 bits. Your console app just got access to Dependency Injection as a first-class citizen in your project, with access to information about whichever app it was that contained that project.json file. </p>
<p>Consider the EF command mapping again for migrations for a second: what is going on when you tell it to add a migration?  It goes something like this:</p>
<ol>
<li>DNX looks for the project.json at the path you provide</li>
<li>It parses the project.json file and finds the command mapping associated with your statement</li>
<li>I <strong><em>creates an instance</em></strong> of the class that contains your command, injecting environment and project information as is available</li>
<li>It checks the rest of what you've passed in, and invokes the command, passing in any parameters that you've supplied</li>
</ol>
<h2>How to Build Your Own</h2>
<p>This is actually super easy!  Here's what you need to do:</p>
<ol>
<li>Create a new ASP.NET 5 Console Application in Visual Studio 2015</li>
<li>Add any services interfaces you need as parameters to the constructor of the Program class – but this is optional in the &quot;hello dnx&quot; realm of requirements</li>
<li>Add your logic to your Main method – start with something as simple as a Console.WriteLine statement</li>
</ol>
<p>From there, you can drop to a command line and run your command. That's it!</p>
<blockquote>
<p><strong>Pro Tip</strong> You can easily get a command line in your project folder by right-clicking on the project in Solution Explorer and selecting &quot;Open Folder in File Explorer&quot;. When File Explorer opens, simply type in &quot;cmd&quot; or &quot;powershell&quot; in the location bar and you'll get your shell.</p>
</blockquote>
<p>The secret as to why it works from the console can be found in your project.json: when you create a console app from the project templates, the command alias mapping for your project is automatically added to your project.  In this same way, along with referencing your new command project, <em>other projects</em> can now consume your command.</p>
<h2>Beyond Hello World</h2>
<p>It is far more likely that you're going to need to do something in the context of the project which uses your command. Minimally, you're likely going to need some configuration drawn in as a default or as a parameter in your command. Let's look at how you would take that hello world app you created in three steps and do something a little more meaningful with it.</p>
<p>First, let's add some dependencies to your project.json:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"Microsoft.Framework.Runtime.Abstractions"</span>: <span class="string">"1.0.0-beta6"</span>,</span><br><span class="line">    <span class="string">"Microsoft.Framework.Configuration.Abstractions"</span>: <span class="string">"1.0.0-beta6"</span>,</span><br><span class="line">    <span class="string">"Microsoft.Framework.Configuration.Json"</span>: <span class="string">"1.0.0-beta6"</span>,</span><br><span class="line">    <span class="string">"Microsoft.Framework.Configuration.UserSecrets"</span>: <span class="string">"1.0.0-beta6"</span>,</span><br><span class="line">    <span class="string">"Microsoft.Framework.Configuration.CommandLine"</span>: <span class="string">"1.0.0-beta6"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now let's add a new JSON file to our project called config.json with the following contents:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"command-text"</span>: <span class="string">"Say hello to my little DNX"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Getting there. Next, let's bulk up the constructor of the Program class, add a private member and a Configuration property:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> IApplicationEnvironment _appEnv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Program</span>(<span class="params">IApplicationEnvironment appEnv</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _appEnv = appEnv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> IConfiguration Configuration &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>We also need to add a method to Program that handles loading the config, taking in what it can from the config file, but loading on top of that any arguments passed in from the console:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BuildConfiguration</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> builder = <span class="keyword">new</span> ConfigurationBuilder(_appEnv.ApplicationBasePath)</span><br><span class="line">        .AddJsonFile(<span class="string">"config.json"</span>)</span><br><span class="line">        .AddCommandLine(args);</span><br><span class="line"></span><br><span class="line">    Configuration = builder.Build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally, we'll add a little more meat to our our Main method:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BuildConfiguration(args);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(Configuration.Get(<span class="string">"command-text"</span>));</span><br><span class="line">    Console.ReadLine();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above sample can now be executed as a command. I've got the following command mapping in my project.json file (yes, the same project you use to create the command can also expose the command):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"commands"</span>: &#123;</span><br><span class="line">    <span class="string">"DnxCommands"</span>: <span class="string">"DnxCommands"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This means that from the console in the dir of my project I can just type in the following:</p>
<pre><code>dnx . DnxCommands
</code></pre>
<p>I can also now reference this project from any other project (or push my bits to NuGet and share them to any project) and use the command from there. Other projects can add the &quot;command-text&quot; key to their config.json files and specify their own value, or they can feed in the parameter as an arg to the command:</p>
<pre><code>dnx . DnxCommands command-text=&quot;'Pop!' goes the weasel&quot;
</code></pre>
<p>In my <a href="https://github.com/MisterJames/DnxCommands/" target="_blank" rel="noopener">sample solution on GitHub</a>, I also have a second project which renames the alias and has it's own config file that is read in by the command.</p>
<h2>Next Steps</h2>
<p>All of this opens the doors for some pretty powerful scenarios. Think about what you can do in your build pipeline without having to write, expose and consume custom msbuild targets. You can create commands that are used to build up local databases for new environments or automate the seeding of tables for integration tests. You could add scaffolders and image optimizers and deployment tools and send text messages to your Grandma.</p>
<p>What you should do next is to look at the kinds of things you do when you're working on your solution – not in it – and think about how you might be able to simplify those tasks. If there are complex parts of your build scripts that you encounter from one project to the next, perhaps you can abstract some of those bits away into a command and then shift to using simplified build scripts that invoke your commands via DNX.</p>
<p>To get some inspiration, check out my <a href="https://github.com/MisterJames/DnxCommands/" target="_blank" rel="noopener">sample project on GitHub</a>, the DNX commands for other libraries (such as
<span style="text-decoration: line-through;">EF</span> or <span style="text-decoration: line-through;">xUnit</span>) and try writing a few of your own.</p>
<p>Happy coding! <img src="https://jcblogimages.blob.core.windows.net/img/2015/08/wlEmoticon-smile1.png" alt="Smile"></p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/james_chambers">
				
					<img src='https://www.gravatar.com/avatar/1ac8c631c34a86ddcfb6ae67f6a7a551?s=200' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/james_chambers">James Chambers</a></h2>
			
			<a href="mailto:james@jameschambers.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://jameschambers.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/canadianjames" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/MisterJames" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			<a href="https://www.linkedin.com/in/canadianjames" target="_blank"><img class="ProfileIcon" src="/images/icon_linkedin.png" border="0" alt="LinkedIN" title="LinkedIN"> LinkedIn</a><br>
			
			
 			<a href="/feeds/james_chambers.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/_/writing-custom-commands-for-dnx-with-asp-net-5-0/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'james_chambers');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
