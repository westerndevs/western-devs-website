<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Building a TFS 2015 PowerShell Module using Nuget | Western Devs</title>
  <meta name="description" content="Update: Unwittingly, I hadn’t tested my Nuget approach on a server with no Visual Studio or TFS installations on it and I’ve missed a couple assemblies that are required when loading the TFS Object mo">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a TFS 2015 PowerShell Module using Nuget">
<meta property="og:url" content="https://westerndevs.com/_/tfs-module-in-powershell-using-nuget/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="Update: Unwittingly, I hadn’t tested my Nuget approach on a server with no Visual Studio or TFS installations on it and I’ve missed a couple assemblies that are required when loading the TFS Object mo">
<meta property="og:image" content="https://agileramblings.files.wordpress.com/2015/07/mytfsmodule_in_action.png?w=502&amp;h=176">
<meta property="article:published_time" content="2015-07-24T03:30:00.000Z">
<meta property="article:modified_time" content="2021-06-07T17:31:31.059Z">
<meta property="article:author" content="Western Devs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://agileramblings.files.wordpress.com/2015/07/mytfsmodule_in_action.png?w=502&amp;h=176">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.0"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">JUL</div>
    <div class="ListLrgDateDay">24</div>
    <div class="ListLrgDateYear">2015</div>
  </div>
  <h2>Building a TFS 2015 PowerShell Module using Nuget</h2>
</div>

		    

<p class="TXTsm">ORIGINALLY POSTED TO: <a href="http://agileramblings.com/2015/07/23/building-a-tfs-2015-powershell-module-using-nuget/" target="_blank" rel="noopener" class='originalurl'>http://agileramblings.com/2015/07/23/building-a-tfs-2015-powershell-module-using-nuget/</a></p>



			<div id="mainPostContent">
	        <p><em>Update:</em> Unwittingly, I hadn’t tested my Nuget approach on a server with no Visual Studio or TFS installations on it and I’ve missed a couple assemblies that are required when loading the TFS Object model. I’ve updated the line of code in my samples, but just in case, here is the new version of the line in question.</p>
<a id="more"></a>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$net45Dlls</span> = <span class="variable">$allDlls</span> | ? &#123;<span class="variable">$_</span>.PSPath.Contains(<span class="string">"portable"</span>) <span class="operator">-ne</span> <span class="variable">$true</span> &#125; | ? &#123;<span class="variable">$_</span>.PSPath.Contains(<span class="string">"resources"</span>) <span class="operator">-ne</span> <span class="variable">$true</span> &#125; | ? &#123; (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"net45"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) <span class="operator">-or</span> (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"native"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) <span class="operator">-or</span> (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"Microsoft.ServiceBus"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) &#125;</span><br></pre></td></tr></table></figure>
<p>The update is the addition of two <em>-or</em> statements to the last inclusive where clause.</p>
<p>I’ve also slightly changed the <em>Import-TfsAssemblies</em> function to include a try/catch block for better error reporting.</p>
<h4>Original Start</h4>
<p>With the release of <a href="https://www.visualstudio.com/" target="_blank" rel="noopener">Visual Studio 2015</a> on July 20, 2015, we can talk about and explore a lot of really cool things that are happening with Visual Studio (VS) and Team Foundation Server (TFS). One of the things that has been a bit of a pain when managing a TFS on-premises installation has been the necessity of installing Visual Studio to get the TFS client object model on your administrative workstation. With the explosive use of PowerShell to manage all things Microsoft, this has been a bit of a drag on using PowerShell for TFS work. There are PowerShell modules for TFS in the TFS Power Tools, but sometimes you need the power that comes with using the TFS Object Model. Which meant that you had to install Visual Studio. I'm really glad to say that is no longer the case. With the release of TFS 2015, the TFS Object Model is now available on <a href="http://www.nuget.org/" target="_blank" rel="noopener">Nuget</a>! With our trusty nuget.exe, we can now get the TFS object model from a trusted source, without violating any license terms, to use in our own TFS PowerShell modules.</p>
<p>I'm not going to profess to be a PowerShell wizard so I hope I'm not breaking any community best practices too badly. I'm more than happy to adapt my implementation if I get feedback on better ways of doing things! It should also be noted that I'm using PowerShell 4. This is located in the Windows Managment Framework 4 download (http://www.microsoft.com/en-ca/download/details.aspx?id=40855), a free download from Microsoft. I don't **<em>think </em>**you'll have any problems upgrading from previous versions of PowerShell but I'm not going to any assurances.</p>
<p>Let's start walking through building a TFS PowerShell module!</p>
<h2>Create A PowerShell Module</h2>
<p>I'm not going to go into a lot of details, but the basic steps to creating your PowerShell module are:</p>
<ol>
<li>Navigate to %USERPROFILE%\My Documents\WindowsPowerShell\Modules</li>
<li>Create a folder called MyTfsModule</li>
<li>In the MyTfsFolder, create a file called MyTfsModule.psm1</li>
</ol>
<p>It is important that the name of the Module folder and the Module file are the same. Otherwise, you won't be able to load your module. This one requirement tripped me up for a while when I started writing PowerShell modules.</p>
<h2>Module-Specific Variables And Helper Functions</h2>
<p>There are a few module specific variables that we need to set when the module loads and a Helper function that I use for getting/creating folders. You can put these at the top of your MyTfsModule.psm1 file.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Write-Host</span> <span class="string">"Loading MyTfsModule"</span></span><br><span class="line"><span class="comment">#Module location folder</span></span><br><span class="line"><span class="variable">$ModuleRoot</span> = <span class="built_in">Split-Path</span> <span class="literal">-Parent</span> <span class="literal">-Path</span> <span class="variable">$MyInvocation</span>.MyCommand.Definition</span><br><span class="line"><span class="comment">#where to put TFS Client OM files</span></span><br><span class="line"><span class="variable">$omBinFolder</span> = <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRootTFSOMbin</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># TFS Object Model Assembly Names</span></span><br><span class="line"><span class="variable">$vsCommon</span> = <span class="string">"Microsoft.VisualStudio.Services.Common"</span></span><br><span class="line"><span class="variable">$commonName</span> = <span class="string">"Microsoft.TeamFoundation.Common"</span></span><br><span class="line"><span class="variable">$clientName</span> = <span class="string">"Microsoft.TeamFoundation.Client"</span></span><br><span class="line"><span class="variable">$VCClientName</span> = <span class="string">"Microsoft.TeamFoundation.VersionControl.Client"</span></span><br><span class="line"><span class="variable">$WITClientName</span> = <span class="string">"Microsoft.TeamFoundation.WorkItemTracking.Client"</span></span><br><span class="line"><span class="variable">$BuildClientName</span> = <span class="string">"Microsoft.TeamFoundation.Build.Client"</span></span><br><span class="line"><span class="variable">$BuildCommonName</span> = <span class="string">"Microsoft.TeamFoundation.Build.Common"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New-Folder</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">    <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">    This function creates new folders</span></span><br><span class="line"><span class="comment">    <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">    This function will create a new folder if required or return a reference to</span></span><br><span class="line"><span class="comment">    the folder that was requested to be created if it already exists.</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    New-Folder "C:TempMyNewFolder"</span></span><br><span class="line"><span class="comment">    <span class="doctag">.PARAMETER folderPath</span></span></span><br><span class="line"><span class="comment">    String representation of the folder path requested</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line"></span><br><span class="line">    [<span class="type">CmdLetBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>, <span class="type">ValueFromPipeline</span>=<span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$folderPath</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">begin</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$folderPath</span>))&#123;</span><br><span class="line">            <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> directory <span class="literal">-Path</span> <span class="variable">$folderPath</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">Get-Item</span> <span class="literal">-Path</span> <span class="variable">$folderPath</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">end</span> &#123;&#125;</span><br><span class="line">&#125; <span class="comment">#end Function New-Directory</span></span><br></pre></td></tr></table></figure>
<h2>First We Get Nuget</h2>
<p>The first thing we need to do is get the Nuget.exe from the web. This is very easily down with the following PowerShell function</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-Nuget</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">    <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">    This function gets Nuget.exe from the web</span></span><br><span class="line"><span class="comment">    <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">    This function gets nuget.exe from the web and stores it somewhere relative to</span></span><br><span class="line"><span class="comment">    the module folder location</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line">    [<span class="type">CmdLetBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">begin</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">process</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">#where to get Nuget.exe from</span></span><br><span class="line">        <span class="variable">$sourceNugetExe</span> = <span class="string">"http://nuget.org/nuget.exe"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#where to save Nuget.exe too</span></span><br><span class="line">        <span class="variable">$targetNugetFolder</span> = <span class="built_in">New-Folder</span> <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRootNuget</span>"</span>)</span><br><span class="line">        <span class="variable">$targetNugetExe</span> = <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRootNugetnuget</span>.exe"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment"># check if we have gotten nuget before</span></span><br><span class="line">            <span class="variable">$nugetExe</span> = <span class="variable">$targetNugetFolder</span>.GetFiles() | ? &#123;<span class="variable">$_</span>.Name <span class="operator">-eq</span> <span class="string">"nuget.exe"</span>&#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$nugetExe</span> <span class="operator">-eq</span> <span class="variable">$null</span>)&#123;</span><br><span class="line">                <span class="comment">#Get Nuget from a well known location on the web</span></span><br><span class="line">                <span class="built_in">Invoke-WebRequest</span> <span class="variable">$sourceNugetExe</span> <span class="literal">-OutFile</span> <span class="variable">$targetNugetExe</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> [<span class="type">Exception</span>]</span><br><span class="line">        &#123;</span><br><span class="line">            echo <span class="variable">$_</span>.Exception | <span class="built_in">format-list</span> <span class="literal">-force</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#set an alias so we can use nuget syntactically the way we normally would</span></span><br><span class="line">        <span class="built_in">Set-Alias</span> nuget <span class="variable">$targetNugetExe</span> <span class="literal">-Scope</span> Global <span class="literal">-Verbose</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">end</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ok! When this function is invoked, we should now see a nuget.exe appear at:</p>
<blockquote>
<p>%USERPROFILE%\My Documents\WindowsPowerShell\Modules\MyTfsModule\Nuget\Nuget.exe</p>
</blockquote>
<h2>Using Nuget to get TFS Client Object Model</h2>
<p>Now that we have nuget, we need to get the TFS Client Object model from nuget.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-TfsAssembliesFromNuget</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">    <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">    This function gets all of the TFS Object Model assemblies from nuget</span></span><br><span class="line"><span class="comment">    <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">    This function gets all of the TFS Object Model assemblies from nuget and then</span></span><br><span class="line"><span class="comment">    creates a bin folder of all of the net45 assemblies so that they can be</span></span><br><span class="line"><span class="comment">    referenced easily and loaded as necessary</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line">    [<span class="type">CmdletBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">begin</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">process</span>&#123;</span><br><span class="line">        <span class="comment">#clear out bin folder</span></span><br><span class="line">        <span class="variable">$targetOMbinFolder</span> = <span class="built_in">New-Folder</span> <span class="variable">$omBinFolder</span></span><br><span class="line">        <span class="built_in">Remove-Item</span> <span class="variable">$targetOMbinFolder</span> <span class="literal">-Force</span> <span class="literal">-Recurse</span></span><br><span class="line">        <span class="variable">$targetOMbinFolder</span> = <span class="built_in">New-Folder</span> <span class="variable">$omBinFolder</span></span><br><span class="line">        <span class="variable">$targetOMFolder</span> = <span class="built_in">New-Folder</span> <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRootTFSOM</span>"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#get all of the TFS 2015 Object Model packages from nuget</span></span><br><span class="line">        nuget install <span class="string">"Microsoft.TeamFoundationServer.Client"</span> <span class="literal">-OutputDirectory</span> <span class="variable">$targetOMFolder</span> <span class="literal">-ExcludeVersion</span> <span class="literal">-NonInteractive</span></span><br><span class="line">        nuget install <span class="string">"Microsoft.TeamFoundationServer.ExtendedClient"</span> <span class="literal">-OutputDirectory</span> <span class="variable">$targetOMFolder</span> <span class="literal">-ExcludeVersion</span> <span class="literal">-NonInteractive</span></span><br><span class="line">        nuget install <span class="string">"Microsoft.VisualStudio.Services.Client"</span> <span class="literal">-OutputDirectory</span> <span class="variable">$targetOMFolder</span> <span class="literal">-ExcludeVersion</span> <span class="literal">-NonInteractive</span></span><br><span class="line">        nuget install <span class="string">"Microsoft.VisualStudio.Services.InteractiveClient"</span> <span class="literal">-OutputDirectory</span> <span class="variable">$targetOMFolder</span> <span class="literal">-ExcludeVersion</span> <span class="literal">-NonInteractive</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Copy all of the required .dlls out of the nuget folder structure </span></span><br><span class="line">        <span class="comment">#to a bin folder so we can reference them easily and they are co-located</span></span><br><span class="line">        <span class="comment">#so that they can find each other as necessary when loading</span></span><br><span class="line">        <span class="variable">$allDlls</span> = <span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRoot</span>\TFSOM\"</span>) <span class="literal">-Recurse</span> <span class="operator">-File</span> <span class="literal">-Filter</span> <span class="string">"*.dll"</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># Create list of all the required .dlls</span></span><br><span class="line">        <span class="comment">#exclude portable dlls</span></span><br><span class="line">        <span class="variable">$requiredDlls</span> = <span class="variable">$allDlls</span> | ? &#123;<span class="variable">$_</span>.PSPath.Contains(<span class="string">"portable"</span>) <span class="operator">-ne</span> <span class="variable">$true</span> &#125; </span><br><span class="line">        <span class="comment">#exclude resource dlls</span></span><br><span class="line">        <span class="variable">$requiredDlls</span> = <span class="variable">$requiredDlls</span> | ? &#123;<span class="variable">$_</span>.PSPath.Contains(<span class="string">"resources"</span>) <span class="operator">-ne</span> <span class="variable">$true</span> &#125; </span><br><span class="line">        <span class="comment">#include net45, native, and Microsoft.ServiceBus.dll</span></span><br><span class="line">        <span class="variable">$requiredDlls</span> = <span class="variable">$requiredDlls</span> | ? &#123; (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"net45"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) <span class="operator">-or</span> (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"native"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) <span class="operator">-or</span> (<span class="variable">$_</span>.PSPath.Contains(<span class="string">"Microsoft.ServiceBus"</span>) <span class="operator">-eq</span> <span class="variable">$true</span>) &#125;</span><br><span class="line">        <span class="comment">#copy them all to a bin folder</span></span><br><span class="line">        <span class="variable">$requiredDlls</span> | % &#123; <span class="built_in">Copy-Item</span> <span class="literal">-Path</span> <span class="variable">$_</span>.Fullname <span class="literal">-Destination</span> <span class="variable">$targetOMBinFolder</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">end</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function does a could things. First it cleans out the existing bin folder, if it exists. Then it goes to nuget to get all of the packages that are available there. They are:</p>
<ol>
<li>http://www.nuget.org/packages/Microsoft.VisualStudio.Services.Client/</li>
<li>http://www.nuget.org/packages/Microsoft.VisualStudio.Services.InteractiveClient/</li>
<li>http://www.nuget.org/packages/Microsoft.TeamFoundationServer.Client/</li>
<li>http://www.nuget.org/packages/Microsoft.TeamFoundationServer.ExtendedClient/</li>
</ol>
<p>I use a number of switches on my invocation of the nuget.exe.</p>
<ul>
<li>-OutputDirectory – This sets the output directory for the nuget activities</li>
<li>-ExcludeVersion – This tells Nuget not to append version numbers to package folders</li>
<li>-NonInteractive – Don't prompt me for anything</li>
</ul>
<p>The next part seems a bit verbose, but I'm leaving it that way as an example of achieving my intent in case you want to achieve something else. I am intending to get all of the net45, non-portable, base language (non-resource) assemblies from the directory structure that is created by nuget when getting the packages. In order to do that I:</p>
<ol>
<li>Find all .dll files in the directory structure, recursively</li>
<li>Exclude .dll files that have &quot;portable&quot; in their path</li>
<li>Exclude .dll files that have &quot;resource&quot; in their path</li>
<li>Include only .dll files that have &quot;net45″, &quot;native&quot;, or &quot;Microsoft.ServiceBus&quot; in their path</li>
</ol>
<p>After I've narrowed it down to that list of .dll files, I copy them all to the TFSOMbin folder where they will be referenced from. This also allows them to satisfy their dependencies on each other as required when loaded.</p>
<h2>Loading the TFS Object Models Assemblies</h2>
<p>Now that we've retrieved the TFS Object model, and tucked it away in a bin folder we can find, we are now ready to load these assemblies into the PowerShell session that this module is in.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Import-TFSAssemblies</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">     <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">     This function imports TFS Object Model assemblies into the PowerShell session</span></span><br><span class="line"><span class="comment">     <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">     After the TFS 2015 Object Model has been retrieved from Nuget using</span></span><br><span class="line"><span class="comment">     Get-TfsAssembliesFromNuget function,  this function will import the necessary</span></span><br><span class="line"><span class="comment">     (given current functions) assemblies into the PowerShell session</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line">    [<span class="type">CmdLetBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">begin</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">process</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$omBinFolder</span> = <span class="variable">$</span>(<span class="string">"<span class="variable">$ModuleRootTFSOMbin</span>"</span>);</span><br><span class="line">        <span class="variable">$targetOMbinFolder</span> = <span class="built_in">New-Folder</span> <span class="variable">$omBinFolder</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$vsCommon</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$commonName</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$clientName</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$VCClientName</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$WITClientName</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$BuildClientName</span> + <span class="string">".dll"</span>)</span><br><span class="line">            <span class="built_in">Add-Type</span> <span class="literal">-LiteralPath</span> <span class="variable">$</span>(<span class="variable">$targetOMbinFolder</span>.PSPath + <span class="variable">$BuildCommonName</span> + <span class="string">".dll"</span>)</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="variable">$_</span>.Exception.LoaderExceptions | <span class="variable">$</span> &#123; <span class="variable">$_</span>.Message &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">end</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2>Putting the Object Model to Use</h2>
<p>Now that we have the TFS Object Model loaded into this PowerShell session, we can use it! I'm going to show three functions. One that gets the TfsConfigurationServer object (basically your connection to the TFS server), one that gets the TeamProjectCollection Ids and a function that will get a list of all TFS Event Subscriptions on the server.</p>
<h3>Get-TfsConfigServer</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-TfsConfigServer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">    <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">    Get a Team Foundation Server (TFS) Configuration Server object</span></span><br><span class="line"><span class="comment">    <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">    The TFS Configuration Server is used for basic authentication and represents</span></span><br><span class="line"><span class="comment">    a connection to the server that is running Team Foundation Server.</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    Get-TfsConfigServer "&amp;lt;Url to TFS&amp;gt;"</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    Get-TfsConfigServer "http://localhost:8080/tfs"</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    gtfs "http://localhost:8080/tfs"</span></span><br><span class="line"><span class="comment">    <span class="doctag">.PARAMETER url</span></span></span><br><span class="line"><span class="comment">     The Url of the TFS server that you'd like to access</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line">    [<span class="type">CmdletBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$url</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">begin</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Verbose</span> <span class="string">"Loading TFS OM Assemblies for 2015 (14.83.0)"</span></span><br><span class="line">        <span class="built_in">Import-TFSAssemblies</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">process</span> &#123;</span><br><span class="line">        <span class="variable">$retVal</span> = [<span class="type">Microsoft.TeamFoundation.Client.TfsConfigurationServerFactory</span>]::GetConfigurationServer(<span class="variable">$url</span>)</span><br><span class="line">        [<span class="built_in">void</span>]<span class="variable">$retVal</span>.Authenticate()</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$retVal</span>.HasAuthenticated)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">"Not Authenticated"</span></span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="variable">$null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">"Authenticated"</span></span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="variable">$retVal</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">end</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Verbose</span> <span class="string">"ConfigurationServer object created."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">#end Function Get-TfsConfigServer</span></span><br></pre></td></tr></table></figure>
<p>This function takes a Url and returns an instance of a Microsoft.TeamFoundation.Client.TfsConfigurationServer. This connection object will be authenticated (via Windows Integrated Authentication). If you don't have permission within the domain to administer the TFS server, you won't be able to use the functions provided by the object model. The other functions require this connection in order to do their additional work.</p>
<h3>Get-TfsProjectCollections</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-TfsTeamProjectCollectionIds</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">    <span class="doctag">.SYNOPSIS</span></span></span><br><span class="line"><span class="comment">    Get a collection of Team Project Collection (TPC) Id</span></span><br><span class="line"><span class="comment">    <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">    Get a collection of Team Project Collection (TPC) Id from the server provided</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    Get-TfsTeamProjectCollectionIds $configServer</span></span><br><span class="line"><span class="comment">    <span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">    Get-TfsConfigServer "http://localhost:8080/tfs" | Get-TfsTeamProjectCollectionIds</span></span><br><span class="line"><span class="comment">    <span class="doctag">.PARAMETER configServer</span></span></span><br><span class="line"><span class="comment">    The TfsConfigurationServer object that represents a connection to TFS server that you'd</span></span><br><span class="line"><span class="comment">    like to access</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line">    [<span class="type">CmdLetBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>, <span class="type">ValueFromPipeline</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="type">Microsoft.TeamFoundation.Client.TfsConfigurationServer</span>]<span class="variable">$configServer</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">begin</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">process</span>&#123;</span><br><span class="line">        <span class="comment"># Get a list of TeamProjectCollections</span></span><br><span class="line">        [<span class="type">guid</span>[]]<span class="variable">$types</span> = [<span class="type">guid</span>][<span class="type">Microsoft.TeamFoundation.Framework.Common.CatalogResourceTypes</span>]::ProjectCollection</span><br><span class="line">        <span class="variable">$options</span> = [<span class="type">Microsoft.TeamFoundation.Framework.Common.CatalogQueryOptions</span>]::None</span><br><span class="line">        <span class="variable">$configServer</span>.CatalogNode.QueryChildren( <span class="variable">$types</span>, <span class="variable">$false</span>, <span class="variable">$options</span>) | % &#123; <span class="variable">$_</span>.Resource.Properties[<span class="string">"InstanceId"</span>]&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">end</span>&#123;&#125;</span><br><span class="line">&#125; <span class="comment">#end Function Get-TfsTeamProjectCollectionIds</span></span><br></pre></td></tr></table></figure>
<h3>Get-TfsEventSubscriptions</h3>
<p>We are using a 3rd party tool that subscribes to build events and we needed to know if it was releasing those subscriptions properly and also discover where this tool was running. We thought that the easiest way to do this was to look at all of the subscriptions in the TFS Project Collections in our AppTier.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#adapted from http://blogs.msdn.com/b/alming/archive/2013/05/06/finding-subscriptions-in-tfs-2012-using-powershell.aspx</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-TFSEventSubscriptions</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    [<span class="type">CmdLetBinding</span>()]</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">parameter</span>(<span class="type">Mandatory</span> = <span class="variable">$true</span>)]</span><br><span class="line">        [<span class="type">Microsoft.TeamFoundation.Client.TfsConfigurationServer</span>]<span class="variable">$configServer</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">begin</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">process</span>&#123;</span><br><span class="line">        <span class="variable">$tpcIds</span> = <span class="built_in">Get-TfsTeamProjectCollectionIds</span> <span class="variable">$configServer</span></span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$tpcId</span> <span class="keyword">in</span> <span class="variable">$tpcIds</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">#Get TPC instance</span></span><br><span class="line">            <span class="variable">$tpc</span> = <span class="variable">$configServer</span>.GetTeamProjectCollection(<span class="variable">$tpcId</span>)</span><br><span class="line">            <span class="comment">#TFS Services to be used</span></span><br><span class="line">            <span class="variable">$eventService</span> = <span class="variable">$tpc</span>.GetService(<span class="string">"Microsoft.TeamFoundation.Framework.Client.IEventService"</span>)</span><br><span class="line">            <span class="variable">$identityService</span> = <span class="variable">$tpc</span>.GetService(<span class="string">"Microsoft.TeamFoundation.Framework.Client.IIdentityManagementService"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$sub</span> <span class="keyword">in</span> <span class="variable">$eventService</span>.GetAllEventSubscriptions())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">#First resolve the subscriber ID</span></span><br><span class="line">                <span class="variable">$tfsId</span> = <span class="variable">$identityService</span>.ReadIdentity(</span><br><span class="line">                    [<span class="type">Microsoft.TeamFoundation.Framework.Common.IdentitySearchFactor</span>]::Identifier,</span><br><span class="line">                    <span class="variable">$sub</span>.Subscriber,</span><br><span class="line">                    [<span class="type">Microsoft.TeamFoundation.Framework.Common.MembershipQuery</span>]::None,</span><br><span class="line">                    [<span class="type">Microsoft.TeamFoundation.Framework.Common.ReadIdentityOptions</span>]::None )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$tfsId</span>.UniqueName)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="variable">$subscriberId</span> = <span class="variable">$tfsId</span>.UniqueName</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="variable">$subscriberId</span> = <span class="variable">$tfsId</span>.DisplayName</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">#then create custom PSObject</span></span><br><span class="line">                <span class="variable">$subPSObj</span> = <span class="built_in">New-Object</span> PSObject <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;</span><br><span class="line">                    AppTier = <span class="variable">$tpc</span>.Uri</span><br><span class="line">                    ID = <span class="variable">$sub</span>.ID</span><br><span class="line">                    Device = <span class="variable">$sub</span>.Device</span><br><span class="line">                    Condition = <span class="variable">$sub</span>.ConditionString</span><br><span class="line">                    EventType = <span class="variable">$sub</span>.EventType</span><br><span class="line">                    Address = <span class="variable">$sub</span>.DeliveryPreference.Address</span><br><span class="line">                    Schedule = <span class="variable">$sub</span>.DeliveryPreference.Schedule</span><br><span class="line">                    DeliveryType = <span class="variable">$sub</span>.DeliveryPreference.Type</span><br><span class="line">                    SubscriberName = <span class="variable">$subscriberId</span></span><br><span class="line">                    Tag = <span class="variable">$sub</span>.Tag</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="comment">#Send object to the pipeline. You could store it on an Arraylist, but that just</span></span><br><span class="line">               <span class="comment">#consumes more memory</span></span><br><span class="line">               <span class="variable">$subPSObj</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">#This is another variation where we just add a property to the existing Subscription object</span></span><br><span class="line">               <span class="comment">#this might be desirable since it will keep the other members</span></span><br><span class="line">               <span class="comment">#Add-Member -InputObject $sub -NotePropertyName SubscriberName -NotePropertyValue $subscriberId</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">end</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2>All Done</h2>
<p>We are now all done creating our initial MyTfsModule implementation! We should be able to load it up now and give it a spin!</p>
<p><img src="https://agileramblings.files.wordpress.com/2015/07/mytfsmodule_in_action.png?w=502&amp;h=176" alt="MyTfsModule_In_Action"></p>
<p>I've obscured the name of my running module and TFS server, but in those spots, just use the name of your module and TFS server.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> MyTfsModule</span><br><span class="line"><span class="variable">$configServer</span> = <span class="built_in">Get-TfsConfigServer</span> http://&lt;name of your TFS server&gt;:<span class="number">8080</span>/tfs</span><br><span class="line"><span class="variable">$allEventsOnServer</span> = <span class="built_in">Get-TfsEventSubscriptions</span> <span class="variable">$configServer</span></span><br><span class="line"><span class="variable">$allEventsOnServer</span>.Length</span><br></pre></td></tr></table></figure>
<h2>Final Thoughts</h2>
<p>The key takeaway from this post was that it is great that we can now get the TFS Object Model from Nuget. Still a bit of a pain to sort and move the downloaded assemblies around, but this is because we I am using PowerShell and not building some sort of C#-based project in Visual Studio which would handle the nuget packages much more elegantly.</p>
<p>I hope this post gives you the information you need to go off and create your own TFS PowerShell module without having to install Visual Studio first!</p>
<p>p.s. I do have a version of this module that loads the assemblies from the install location of Visual Studio. I'll visit that shortly in another blog post.</p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/dave_white">
				
					<img src='https://www.gravatar.com/avatar/4b7708d2ae7f7bb866446e0459e3e156?s=200' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/dave_white">Dave White</a></h2>
			
			<a href="mailto:dmhwhite@gmail.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://agileramblings.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/AgileRamblings" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/agileramblings" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			<a href="https://www.linkedin.com/in/dave-white" target="_blank"><img class="ProfileIcon" src="/images/icon_linkedin.png" border="0" alt="LinkedIN" title="LinkedIN"> LinkedIn</a><br>
			
			
 			<a href="/feeds/dave_white.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/_/tfs-module-in-powershell-using-nuget/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'dave_white');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
