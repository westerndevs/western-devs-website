<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Using PowerShell to Set Your Azure SQL firewall rule | Western Devs</title>
  <meta name="description" content="If you&#39;ve read a couple of my recent blog posts, you&#39;ll see that I&#39;ve been working in PowerShell a lot lately. I&#39;ve also been working with Azure a lot lately as well and I&#39;m getting opportunities to p">
<meta property="og:type" content="article">
<meta property="og:title" content="Using PowerShell to Set Your Azure SQL firewall rule">
<meta property="og:url" content="https://westerndevs.com/_/using-powershell-to-set-your-azure-sql-firewall-rule/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="If you&#39;ve read a couple of my recent blog posts, you&#39;ll see that I&#39;ve been working in PowerShell a lot lately. I&#39;ve also been working with Azure a lot lately as well and I&#39;m getting opportunities to p">
<meta property="article:published_time" content="2015-07-27T03:30:00.000Z">
<meta property="article:modified_time" content="2022-11-02T13:37:20.383Z">
<meta property="article:author" content="Western Devs">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
    <link rel="canonical" href="http://agileramblings.com/2015/07/26/using-powershell-to-set-your-azure-sql-firewall-rule/">
  
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.1"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">JUL</div>
    <div class="ListLrgDateDay">27</div>
    <div class="ListLrgDateYear">2015</div>
  </div>
  <h2>Using PowerShell to Set Your Azure SQL firewall rule</h2>
</div>

		    

<p class="TXTsm">ORIGINALLY POSTED TO: <a href="http://agileramblings.com/2015/07/26/using-powershell-to-set-your-azure-sql-firewall-rule/" target="_blank" rel="noopener" class='originalurl'>http://agileramblings.com/2015/07/26/using-powershell-to-set-your-azure-sql-firewall-rule/</a></p>



			<div id="mainPostContent">
	        <p>If you've read a couple of my recent blog posts, you'll see that I've been working in PowerShell a lot lately. I've also been working with Azure a lot lately as well and I'm getting opportunities to put those two things together.</p>
<a id="more"></a>
<p>Since my laptop is moving around a lot and occasionally my home IP address changes, I do need to update my Azure SQL Firewall rule to allow my computer at my current my IP address to talk to my Azure SQL database server.</p>
<p><a href="https://msdn.microsoft.com/en-us/library/azure/ee621782.aspx" target="_blank" rel="noopener" title="https://msdn.microsoft.com/en-us/library/azure/ee621782.aspx">Azure SQL Database Firewall</a></p>
<p>I've added 4 simple functions to my .\profile.ps1 script that makes this job really easy.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Set-MyAzureFirewallRule</span></span> &#123;</span><br><span class="line">    <span class="variable">$response</span> = <span class="built_in">Invoke-WebRequest</span> ifconfig.me/ip</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$response</span>.Content.Trim()</span><br><span class="line">	<span class="built_in">New-AzureSqlDatabaseServerFirewallRule</span> <span class="literal">-StartIPAddress</span> <span class="variable">$ip</span> <span class="literal">-EndIPAddress</span> <span class="variable">$ip</span> <span class="literal">-RuleName</span> &lt;Name of Rule&gt; <span class="literal">-ServerName</span> &lt;your database server name here&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Update-MyAzureFirewallRule</span></span>&#123;</span><br><span class="line">    <span class="variable">$response</span> = <span class="built_in">Invoke-WebRequest</span> ifconfig.me/ip</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$response</span>.Content.Trim()</span><br><span class="line">    <span class="built_in">Set-AzureSqlDatabaseServerFirewallRule</span> <span class="literal">-StartIPAddress</span> <span class="variable">$ip</span> <span class="literal">-EndIPAddress</span> <span class="variable">$ip</span> <span class="literal">-RuleName</span> &lt;Name of Rule&gt; <span class="literal">-ServerName</span> &lt;your database server name here&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-MyAzureFirewallRule</span></span>&#123;</span><br><span class="line">    <span class="built_in">Remove-AzureSqlDatabaseServerFirewallRule</span> <span class="literal">-RuleName</span> &lt;Name of Rule&gt; <span class="literal">-ServerName</span> &lt;your database server name here&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-MyAzureFirewallRule</span></span>&#123;</span><br><span class="line">    <span class="built_in">Get-AzureSqlDatabaseServerFirewallRule</span> <span class="literal">-RuleName</span> &lt;Name of Rule&gt; <span class="literal">-ServerName</span> &lt;your database server name here&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3>Get the Azure PowerShell Module</h3>
<p>The first thing you'll need to do if you want to do any work with Azure via PowerShell is download and install the Azure PowerShell modules.</p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/powershell-install-configure/" target="_blank" rel="noopener" title="https://azure.microsoft.com/en-us/documentation/articles/powershell-install-configure/">Install And Configure Azure PowerShell</a></p>
<p>Once you've done this, you'll be able to run Azure CommandLets in your PowerShell session.</p>
<h3>How to get your IP address</h3>
<p>Since many times I'm behind a router that is doing NAT translations, knowing my IP address isn't as simple as typing <code>Get-NetIPAddress | Format-Table</code> or <code>ipconfig</code> in a console. That will tell me what my computer thinks the IP address is in my local network, but that isn't what Azure will see. Azure will see the IP address of my cable modem.</p>
<p>In order to find out what my IP address is from an external perspective, I need the help of a little service called <a href="http://ifconfig.me/" target="_blank">ifconfig.me</a> to tell me what my IP address is externally. If you make the whole Url <a href="http://ifconfig.me/ip" target="_blank">ifconfig.me/ip</a> you will get a simple text response from them with your IP address. Just give that Url a click and try it out. If you view the page source, you'll see that only text was returned.</p>
<h3>Putting it all together</h3>
<p>So now we have the Azure PowerShell modules and we know about ifconfig.me. All we need now is the put the two together into one of our functions. I'll use my first function as the example. You'll be able to follow the rest after I describe this one.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Set-MyAzureFirewallRule</span></span> &#123;</span><br><span class="line">    <span class="variable">$response</span> = <span class="built_in">Invoke-WebRequest</span> ifconfig.me/ip</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$response</span>.Content.Trim()</span><br><span class="line">	<span class="built_in">New-AzureSqlDatabaseServerFirewallRule</span> <span class="literal">-StartIPAddress</span> <span class="variable">$ip</span> <span class="literal">-EndIPAddress</span> <span class="variable">$ip</span> <span class="literal">-RuleName</span> &lt;Name of Rule&gt; <span class="literal">-ServerName</span> &lt;your database server name here&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The first line is the PowerShell (non-Azure) CmdLet <code>Invoke-WebRequest ifconfig.me/ip</code>. This will call ifconfig.me/ip and get a response, trapped in the <code>$response</code> variable.</p>
<p>In the next line, I clean up the response a little bit using some .Net string functions to move my IP address into the <code>$ip</code> variable.</p>
<p>Finally, I call the Azure PowerShell CmdLet to create a new Firewall rule in my Azure account.</p>
<blockquote>
<p>You will have to have followed the instructions in <a href="https://azure.microsoft.com/en-us/documentation/articles/powershell-install-configure/" target="_blank" rel="noopener" title="https://azure.microsoft.com/en-us/documentation/articles/powershell-install-configure/">Azure PowerShell Install and Configure</a> to set up the authentication to allow this PowerShell session to access your Azure subscription.</p>
</blockquote>
<p>The other three variations of this function are for completeness. You will actually probably use the <code>Update-MyAzureFirewallRule</code> most since you'll set-up the Firewall rule once the first time and then you'll just need to update it whenever your IP address changes.</p>
<h3>Final Thoughts</h3>
<p>I hope this post makes it easier for you to access your SQL Azure database server from your laptop, where ever it may have moved. Once you've set up the rule, you'll be able to access your database server from the tools in Visual Studio, SQL Server Management Studio, or any other tool you prefer to use to work with your Azure SQL Server.</p>
<p>Enjoy!!</p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/dave_white">
				
					<img src='https://www.gravatar.com/avatar/4b7708d2ae7f7bb866446e0459e3e156?s=200' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/dave_white">Dave White</a></h2>
			
			<a href="mailto:dmhwhite@gmail.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://agileramblings.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/AgileRamblings" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/agileramblings" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			<a href="https://www.linkedin.com/in/dave-white" target="_blank"><img class="ProfileIcon" src="/images/icon_linkedin.png" border="0" alt="LinkedIN" title="LinkedIN"> LinkedIn</a><br>
			
			
 			<a href="/feeds/dave_white.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/_/using-powershell-to-set-your-azure-sql-firewall-rule/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'dave_white');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
