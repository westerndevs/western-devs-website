<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Self generating data | Western Devs</title>
  <meta name="description" content="Every week I meet for Code and Coffee with other devs to chat about all kind of topics (often related to software) and lately we have been doing Katas from CodeWars under the WpgDotNet clan. This time">
<meta property="og:type" content="article">
<meta property="og:title" content="Self generating data">
<meta property="og:url" content="https://westerndevs.com/_/property-testing/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="Every week I meet for Code and Coffee with other devs to chat about all kind of topics (often related to software) and lately we have been doing Katas from CodeWars under the WpgDotNet clan. This time">
<meta property="article:published_time" content="2015-10-12T08:39:34.000Z">
<meta property="article:modified_time" content="2024-09-10T05:06:20.801Z">
<meta property="article:author" content="Western Devs">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.1"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">OCT</div>
    <div class="ListLrgDateDay">12</div>
    <div class="ListLrgDateYear">2015</div>
  </div>
  <h2>Self generating data</h2>
</div>

		    

			<div id="mainPostContent">
	        <p>Every week I meet for <a href="http://www.meetup.com/wpgcoffeecode" target="_blank" rel="noopener">Code and Coffee</a> with other devs to chat about all kind of topics (often related to software) and lately we have been doing Katas from <a href="http://codewars.com" target="_blank" rel="noopener">CodeWars</a> under the <em>WpgDotNet</em> clan.</p>
<p>This time around I was working with <a href="https://twitter.com/QuinnWilson" target="_blank" rel="noopener">@QuinnWilson</a> and <a href="https://twitter.com/AdamKrieger" target="_blank" rel="noopener">@AdamKrieger</a> doing the <a href="http://www.codewars.com/kata/highest-and-lowest" target="_blank" rel="noopener">Highest and lowest</a> Kata using Ruby and <a href="http://rspec.info" target="_blank" rel="noopener">RSpec</a>.</p>
<p>Is a simple Kata but I wanted to put focus on TDD, self data generation and property testing...</p>
<a id="more"></a>
<h2>The scenarios</h2>
<p>I won't go into the TDD steps because I want to fast forward to data generation.</p>
<p>We created three tests, from the domain of the problem first we selected strings that contain only one number then the result should be that number as max and min.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context <span class="string">'When the string has only one number'</span> <span class="keyword">do</span>                       </span><br><span class="line">  it <span class="string">'Returns the same number twice'</span> <span class="keyword">do</span>                                </span><br><span class="line">    str = <span class="string">"1"</span>                                                          </span><br><span class="line">    expect(highest_lowest str).to eq <span class="string">"1 1"</span>                             </span><br><span class="line">  <span class="keyword">end</span>                                                                  </span><br><span class="line"><span class="keyword">end</span>   </span><br></pre></td></tr></table></figure>
<p>For our second scenario we thought that it would be easy if the sequence of numbers where already sorted, so the min and max are the <code>first</code> and <code>last</code>.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context <span class="string">'When the numbers are sorted'</span> <span class="keyword">do</span>                               </span><br><span class="line">  it <span class="string">'returns the last and the first'</span> <span class="keyword">do</span>                               </span><br><span class="line">    str = <span class="string">'-5 -2 8 12 32 150'</span>                                          </span><br><span class="line">    expect(highest_lowest str).to eq <span class="string">"150 -5"</span>                          </span><br><span class="line">  <span class="keyword">end</span>                                                                  </span><br><span class="line"><span class="keyword">end</span>                                                                    </span><br></pre></td></tr></table></figure>
<p>The last scenario includes all the strings with sequence of integers.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context <span class="string">'For any string with one or more numbers separated by space'</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'returns the max and the min'</span> <span class="keyword">do</span>                                  </span><br><span class="line">    str = <span class="string">'22 -5 28 -294 33 1794 10000 2'</span>                              </span><br><span class="line">    expect(highest_lowest str).to eq <span class="string">"10000 -294"</span>                      </span><br><span class="line">  <span class="keyword">end</span>                                                                  </span><br><span class="line"><span class="keyword">end</span>                                                                    </span><br></pre></td></tr></table></figure>
<p>Ruby has a <code>minmax</code> method on <code>Array</code> but we wanted to do it using a <code>fold</code>. So here is our implementation:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">highest_lowest</span><span class="params">(str)</span></span></span><br><span class="line">  str.split.map(&amp;<span class="symbol">:to_i</span>).inject([MIN, MAX]) <span class="keyword">do</span> <span class="params">|mm, i|</span></span><br><span class="line">    [[mm.first, i].max, [mm.last, i].min]</span><br><span class="line">  <span class="keyword">end</span>.join <span class="string">' '</span></span><br><span class="line"><span class="keyword">end</span>                                                </span><br></pre></td></tr></table></figure>
<h2>Self generating data</h2>
<p>We did write only one example on each scenario to start but now we wanted to cover more cases.</p>
<p>Not only I want to generate random data but I want to have a reasonable distribution of values and
describe it as a property that the function has to satisfy.</p>
<p>Libraries like <a href="https://hackage.haskell.org/package/QuickCheck" target="_blank" rel="noopener">QuickCheck</a> (for <em>Haskell</em>, main inspiration to others), <a href="https://fscheck.github.io/FsCheck/" target="_blank" rel="noopener">FsCheck</a> (for <em>F#</em>) and <a href="https://www.scalacheck.org" target="_blank" rel="noopener">ScalaCheck</a> (for <em>Scala</em>) do exactly that. For Ruby we used <a href="https://github.com/hayeah/rantly" target="_blank" rel="noopener">Rantly</a>.</p>
<h3>Single integer</h3>
<p>The first scenario requires a string with one <em>integer</em>.</p>
<p>To do that with <em>Rantly</em> we can use the <em>integer</em> generator <code>integer</code>. After converting it to a <code>string</code> we have the input for the test.</p>
<p>Imagine a property that looks like:</p>
<pre><code>Given a string with a single integer N
The result is a string like &quot;{N} {N}&quot;
</code></pre>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it <span class="string">'Returns the same number twice'</span> <span class="keyword">do</span></span><br><span class="line">  property_of &#123;</span><br><span class="line">    n = integer</span><br><span class="line">    n.to_s</span><br><span class="line">  &#125;.check <span class="keyword">do</span> <span class="params">|str, n|</span></span><br><span class="line">    expect(highest_lowest str).to eq <span class="string">"<span class="subst">#&#123;n&#125;</span> <span class="subst">#&#123;n&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><em>Rantly</em> is going to generate 100 cases by default and <em>check</em> to make sure the equality holds for all of them.</p>
<h3>Sorted integers</h3>
<p>Having a sorted sequence of numbers is easy to specify where the min and max should be.</p>
<p>So the property could be something like (in pseudo formal but not so much english):</p>
<pre><code>Given an ordered string of integers
Then the first is the MIN and the last is the MAX
And the result is a string like &quot;{MAX} {MIN}&quot;    
</code></pre>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">context <span class="string">'When the numbers are sorted'</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'returns the last and the first'</span> <span class="keyword">do</span></span><br><span class="line">    property_of &#123;</span><br><span class="line">      arr = array &#123; integer &#125;.sort</span><br><span class="line">      [arr.join(<span class="string">' '</span>), arr.last, arr.first]</span><br><span class="line">    &#125;.check &#123; <span class="params">|str, max, min|</span></span><br><span class="line">      expect(highest_lowest str).to eq <span class="string">"<span class="subst">#&#123;max&#125;</span> <span class="subst">#&#123;min&#125;</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3>The general case</h3>
<p>Thinking of the actual <em>postcondition</em> of the problem, the property could be something like:</p>
<pre><code>Given any non empty collection of integers
And exist MIN and MAX that belong to the collection
Where MAX is the maximum and MIN is the minimum
Then the result is a string like &quot;{MAX} {MIN}&quot;
</code></pre>
<p>Considering for a moment the domain (all the possible instances) of <em>any non empty collection of integers</em>. That would include sets of a single element and also sorted elements, thus we cover the other two scenarios.</p>
<p>I want to generate all the integers but at the same time have the max and min so I don't write the test duplicating the implementation to find maximum and minimum.</p>
<p>To do that, I will generate first the min and max and then add integers in between.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it <span class="string">'returns the max and the min'</span> <span class="keyword">do</span></span><br><span class="line">  property_of &#123;</span><br><span class="line">    min, max = [integer, integer].minmax</span><br><span class="line">    arr = array &#123; range min, max &#125; + [max, min]</span><br><span class="line">    [arr.shuffle.join(<span class="string">' '</span>), max, min]</span><br><span class="line">  &#125;.check(<span class="number">200</span>) <span class="keyword">do</span> <span class="params">|str, max, min|</span></span><br><span class="line">    expect(highest_lowest str).to eq <span class="string">"<span class="subst">#&#123;max&#125;</span> <span class="subst">#&#123;min&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>I changed the number of cases to <em>200</em> just to illustrate how to override the default.</p>
<h2>Using properties</h2>
<p>Properties can be very useful to help identify test cases plus data generation makes much easier to describe a scenario and find a domain for the test.</p>
<p>Having a combination of both <em>property testing</em> and <em>example testing</em> can be a good balance to have tests that are accurate and also descriptive.</p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/amir_barylko">
				
					<img src='https://www.gravatar.com/avatar/fadb1de2c18ab0fc42ebc0988327c90f?s=200' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/amir_barylko">Amir Barylko</a></h2>
			
			<a href="mailto:amir@barylko.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://www.orthocoders.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/abarylko" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/amirci" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			<a href="https://www.linkedin.com/in/amirbarylko" target="_blank"><img class="ProfileIcon" src="/images/icon_linkedin.png" border="0" alt="LinkedIN" title="LinkedIN"> LinkedIn</a><br>
			
			
 			<a href="/feeds/amir_barylko.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/_/property-testing/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'amir_barylko');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
