<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Setting Up an IIS Site Using PowerShell | Western Devs</title>
  <meta name="description" content="The cloud has been such an omnipresent force in my development life that I&#39;d kind of forgotten that IIS even existed. There are, however, some companies that either aren&#39;t ready for the cloud or have">
<meta property="og:type" content="article">
<meta property="og:title" content="Setting Up an IIS Site Using PowerShell">
<meta property="og:url" content="https://westerndevs.com/_/setting-up-an-iis-site-using-powershell/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="The cloud has been such an omnipresent force in my development life that I&#39;d kind of forgotten that IIS even existed. There are, however, some companies that either aren&#39;t ready for the cloud or have">
<meta property="article:published_time" content="2015-08-12T21:29:25.000Z">
<meta property="article:modified_time" content="2023-06-11T02:37:05.469Z">
<meta property="article:author" content="Western Devs">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
    <link rel="canonical" href="http://blog.simontimms.com/2015/08/12/setting-up-an-iis-site-using-powershell/">
  
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.1"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">AUG</div>
    <div class="ListLrgDateDay">12</div>
    <div class="ListLrgDateYear">2015</div>
  </div>
  <h2>Setting Up an IIS Site Using PowerShell</h2>
</div>

		    

<p class="TXTsm">ORIGINALLY POSTED TO: <a href="http://blog.simontimms.com/2015/08/12/setting-up-an-iis-site-using-powershell/" target="_blank" rel="noopener" class='originalurl'>http://blog.simontimms.com/2015/08/12/setting-up-an-iis-site-using-powershell/</a></p>



			<div id="mainPostContent">
	        <p>The cloud has been such an omnipresent force in my development life that I'd kind of forgotten that IIS even existed. There are, however, some companies that either aren't ready for the cloud or have legitimate legal limitations that make using the cloud difficult.</p>
<a id="more"></a>
<p>This doesn't mean that we should abandon some of the niceties of deploying to the cloud such as being able to promote easily between environments. As part of being able to deploy automatically to new environments I wanted to be able to move to a machine that had nothing but IIS installed and run a script to do the deployment.</p>
<p>I was originally thinking about looking into PowerShell Desired State Configuration but noted brain-box <a href="http://www.westerndevs.com/bios/dylan_smith/" target="_blank" rel="noopener">Dylan Smith</a> told me not to bother. He feeling was that it was a great idea whose time had come but the technology wasn't there yet. Instead he suggested just using PowerShell proper.</p>
<p>Well okay. I had no idea how to do that.</p>
<p>So I started digging. I found that PowerShell is really pretty good at setting up IIS. It isn't super well documented, however. The PowerShell documentation is crummy in comparison with stuff in the .net framework. I did hear on an episode of Dot Net Rocks that the UI for IIS calls out to PowerShell for everything now. So it must be possible.</p>
<p>The first step is to load in the powershell module for IIS</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> WebAdministration</span><br></pre></td></tr></table></figure>
<p>That gives us access to all sorts of cool IIS stuff. You can get information on the current configuration by cding into the IIS namespace.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32&gt; cd IIS:</span><br><span class="line">IIS:\&gt; ls</span><br><span class="line"></span><br><span class="line">Name</span><br><span class="line">----</span><br><span class="line">AppPools</span><br><span class="line">Sites</span><br><span class="line">SslBindings</span><br></pre></td></tr></table></figure>
<p>Well that's pretty darn cool. From here you can poke about and look at the AppPools and sites. I was told that by fellow Western Dev <a href="http://www.westerndevs.com/bios/donald_belcham/" target="_blank" rel="noopener">Don Belcham</a> that I should have one AppPool for each application so the first step is to create a new AppPool. I want to be able to deploy over my existing deploys so I have to turff it first.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">Test-Path</span> IIS:\AppPools\CoolWebSite)</span><br><span class="line">&#123;</span><br><span class="line">	echo <span class="string">"App pool exists - removing"</span></span><br><span class="line">	<span class="built_in">Remove-WebAppPool</span> CoolWebSite</span><br><span class="line">	gci IIS:\AppPools</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pool</span> = <span class="built_in">New-Item</span> IIS:\AppPools\CoolWebSite</span><br></pre></td></tr></table></figure>
<p>This particular site needs to run as a particular user instead of the AppPoolUser or LocalSystem or anything like that. These will be passed in as a variable. We need to set the identity type to the confusing value of 3. This maps to using a specific user. The documentation on this is <a href="https://msdn.microsoft.com/en-us/library/ms689446(v=vs.90).aspx" target="_blank" rel="noopener">near impossible to find</a>.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pool</span>.processModel.identityType = <span class="number">3</span></span><br><span class="line"><span class="variable">$pool</span>.processModel.userName = <span class="variable">$deployUserName</span></span><br><span class="line"><span class="variable">$pool</span>.processModel.password = <span class="variable">$deployUserPassword</span></span><br><span class="line"><span class="variable">$pool</span> | <span class="built_in">set-item</span></span><br></pre></td></tr></table></figure>
<p>Opa! We have an app pool. Next up a website. We'll follow the same model of deleting and adding. Really this delete block should be executed before adding the AppPool.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">Test-Path</span> IIS:\Sites\CoolWebSite)</span><br><span class="line">&#123;</span><br><span class="line">echo <span class="string">"Website exists - removing"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Remove-WebSite</span> CoolWebSite</span><br><span class="line">gci IIS:\Sites</span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">"Creating new website"</span></span><br><span class="line"><span class="built_in">New-Website</span> <span class="literal">-name</span> <span class="string">"CoolWebSite"</span> <span class="literal">-PhysicalPath</span> <span class="variable">$deploy_dir</span> <span class="literal">-ApplicationPool</span> <span class="string">"CoolWebSite"</span> <span class="literal">-HostHeader</span> <span class="variable">$deployUrl</span></span><br></pre></td></tr></table></figure>
<p>The final step for this site is to change the authentication to turn off anonymous and turn on windows authentication. This requires using a setter to set individual properties.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-WebConfigurationProperty</span> <span class="literal">-filter</span> /system.webServer/security/authentication/windowsAuthentication <span class="literal">-name</span> enabled <span class="literal">-value</span> true <span class="literal">-PSPath</span> IIS:\Sites\CoolWebSite</span><br><span class="line"><span class="built_in">Set-WebConfigurationProperty</span> <span class="literal">-filter</span> /system.webServer/security/authentication/anonymousAuthentication <span class="literal">-name</span> enabled <span class="literal">-value</span> false <span class="literal">-PSPath</span> IIS:\Sites\CoolWebSite</span><br></pre></td></tr></table></figure>
<p>I'm not completely sure but I would bet that most other properties can also be set via these properties.</p>
<p>Well that's all pretty cool. I think will still investigate PowerShell DSC because I really like the idea of specifying the state I want IIS to be in and have something else figure out how to get there. This is especially true for finicky things like setting authentication.</p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/simon_timms">
				
					<img src='/images/avatars/simon.jpg' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/simon_timms">Simon Timms</a></h2>
			
			<a href="mailto:stimms@gmail.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://blog.simontimms.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/stimms" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/stimms" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			
 			<a href="/feeds/simon_timms.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/_/setting-up-an-iis-site-using-powershell/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'simon_timms');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
