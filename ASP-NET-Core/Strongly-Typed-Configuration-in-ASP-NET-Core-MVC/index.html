<!DOCTYPE html>
<html lang="en" xml:lang="en">

  <head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Strongly-Typed Configuration in ASP.NET Core MVC | Western Devs</title>
  <meta name="description" content="Over the last two posts I worked through the basics of configuration in ASP.NET and how to leverage structured data in your JSON config files. Now it&#39;s time to take a deeper look at how to access rele">
<meta property="og:type" content="article">
<meta property="og:title" content="Strongly-Typed Configuration in ASP.NET Core MVC">
<meta property="og:url" content="https://westerndevs.com/ASP-NET-Core/Strongly-Typed-Configuration-in-ASP-NET-Core-MVC/index.html">
<meta property="og:site_name" content="Western Devs">
<meta property="og:description" content="Over the last two posts I worked through the basics of configuration in ASP.NET and how to leverage structured data in your JSON config files. Now it&#39;s time to take a deeper look at how to access rele">
<meta property="og:image" content="https://jcblogimages.blob.core.windows.net/img/2016/01/typed-settings.png">
<meta property="article:published_time" content="2016-01-23T15:29:12.000Z">
<meta property="article:modified_time" content="2023-03-20T15:13:28.887Z">
<meta property="article:author" content="Western Devs">
<meta property="article:tag" content="ASP.NET Core">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jcblogimages.blob.core.windows.net/img/2016/01/typed-settings.png">
<meta name="twitter:creator" content="@westerndevs">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="WesternDevs">   
    <meta name="keywords" content="software development,software,asp.net,blog">
    <meta name="description" content="We're all west of somewhere">
    <meta name="copyright" content="WesternDevs">
    <meta name="revisit-after" content="15 days">
    <meta name="robots" content="all">
    <meta name="MSSmartTagsPreventParsing" content="true">
  
    <link rel="canonical" href="http://jameschambers.com/2016/01/Strongly-Typed-Configuration-in-ASP-NET-Core-MVC/">
  
  
    <link rel="alternate" href="/feed.xml" title="Western Devs" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

      
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>  
  <meta name="generator" content="Hexo 4.2.1"></head>

<body>

<!-- FIXED HEADER BECAUSE SCROLLING -->
<!--HEADER STARTS-->
<div class="WrapperHeader">
<div style="display:inline-block; text-align: center;">
<div class="Header">

  <div class="HeaderLogo">
    <a href="/"><img src="/images/header_logo_transparent.png" alt="WesternDevs" title="WesternDevs" border="0" style="width: 206px; height: 64px;" width="206" height="64"></a>
  </div>

  <div class="HeaderLinks">
      <a href="/posts" class="nav">POSTS</a>       
      <a href="/podcasts" class="nav">PODCASTS</a>       
      <a href="/whoweare" class="nav">ABOUT</a>  
      <a href="/whatwevedone" class="nav">WHAT WE'VE DONE</a>  
      <a href="/speaking" class="nav">SPEAKING</a>
      <div class="HeaderIcons">
        <a href="mailto:info@westerndevs.com"><img src="/images/icon_email.png" border="0" alt="Email" title="Email" height="26" width="26"></a>
        <a href="/feed.xml"><img src="/images/icon_subscribe.png" border="0" alt="Subscribe" title="Subscribe" height="26" width="27"></a>
        <a href="http://twitter.com/westerndevs" target="_blank"><img src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter" height="26" width="27"></a>
        <a href="http://github.com/westerndevs" target="_blank"><img src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub" height="26" width="27"></a>     
      </div>
  </div>
  
</div>
</div>
</div>
<!--HEADER ENDS-->    



<!--WRAPPER STARTS-->
<div class="Wrapper" style="">

<!--SUBHEAD STARTS-->
<div class="WrapperSubHeaderSubpage">
<center>
	<div class="SubHeader">
		<H1 class="title"><img class="icon" src="/images/icon_posts.png" alt="POST" title="POST" border="0"> POST</H1>
	</div>
</center>
</div>
<!--SUBHEAD ENDS-->

<!--PAGE CONTENT STARTS-->
<center>
<div class="WrapperContent">

<!--MAIN CONTENT STARTS-->
	<div class="SubpageBoxSubLrg">
		<div class="SubpageBoxSubLrgContent">
		    <div class='postTitle'>
  <div class="ListLrgDateBG">
    <div class="ListLrgDateMonth">JAN</div>
    <div class="ListLrgDateDay">23</div>
    <div class="ListLrgDateYear">2016</div>
  </div>
  <h2>Strongly-Typed Configuration in ASP.NET Core MVC</h2>
</div>

		    

<p class="TXTsm">ORIGINALLY POSTED TO: <a href="http://jameschambers.com/2016/01/Strongly-Typed-Configuration-in-ASP-NET-Core-MVC/" target="_blank" rel="noopener" class='originalurl'>http://jameschambers.com/2016/01/Strongly-Typed-Configuration-in-ASP-NET-Core-MVC/</a></p>



			<div id="mainPostContent">
	        <p>Over the last <strong><a href="http://jameschambers.com/2016/01/Configuration-in-ASP-NET-Core-MVC/" target="_blank" rel="noopener">two</a></strong> <strong><a href="http://jameschambers.com/2016/01/json-config-in-aspnetcoremvc/" target="_blank" rel="noopener">posts</a></strong> I worked through the basics of configuration in ASP.NET and how to leverage structured data in your JSON config files. Now it's time to take a deeper look at how to access relevant parts of your configuration throughout the rest of your project.</p>
<p><img src="https://jcblogimages.blob.core.windows.net:443/img/2016/01/typed-settings.png" alt="Strongly-Typed Settings Classes in ASP.NET Core"></p>
<a id="more"></a>
<p>I contribute to an open source project called <a href="https://github.com/HTBox/allReady" target="_blank" rel="noopener">AllReady</a> from the <a href="http://htbox.org" target="_blank" rel="noopener">Humanitarian Toolbox</a>. One of the things that we do on the project is use Azure Storage Queues to send and process messages in a different execution context to keep our main application moving along nicely. In order to do this, I added some properties to the configuration file under a storage node:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Data"</span>: &#123;</span><br><span class="line">  <span class="string">"DefaultConnection"</span>: &#123;</span><br><span class="line">    <span class="string">"ConnectionString"</span>: <span class="string">"Server=(localdb)\\MSSQLLocalDB;Database=AllReady;Integrated Security=true;MultipleActiveResultsets=true;"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"Storage"</span>: &#123;</span><br><span class="line">    <span class="string">"AzureStorage"</span>: <span class="string">"[storagekey]"</span>,    </span><br><span class="line">    <span class="string">"EnableAzureQueueService"</span>: <span class="string">"false"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Obviously, &quot;<code>[storagekey]</code>&quot; is not a valid key to access a storage account in Azure, but you'll notice that I also have a flag in there to enable/disable the queue service. By putting this in place, we can toggle the service used at dev time and, rather than writing to the queue, we can instead write to the local console. Of course, we have the propery key set in our Azure Web App so that it's loaded and overridden at run time with the correct value. I discussed nomenclature of the keys you'd use in my post on <a href="http://jameschambers.com/2016/01/json-config-in-aspnetcoremvc/" target="_blank" rel="noopener">JSON Configuration</a>.</p>
<h2>Exposing Configuration Accross the Application</h2>
<p>Now, to actually put the storage settings from our config in play, we're going to create a class to contain the properties that we will need to inspect at runtime.</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AzureStorageSettings</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> AzureStorage &#123; <span class="built_in">get</span>; <span class="built_in">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> EnableAzureQueueService &#123; <span class="built_in">get</span>; <span class="built_in">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This class is a one-to-one mapping of the values we put in our <code>Storage</code> section. All that's left is to get the values from our configuration in there.</p>
<h2>The Options Pattern for Configuration</h2>
<p>Originally I was loading up these properties one-by-each, line after line of reading from the config and assigning the values to the instance of the <code>AzureStorageSettings</code> class. But in the fall I had the opportunity to work with <a href="https://github.com/rynowak" target="_blank" rel="noopener">Ryan Nowak</a> of the ASP.NET team and he showed me a much better approach with what the ASP.NET team refers to as the options pattern. It's basically closing the loop on the work we have above and giving us the ability to get at our configuration with strongy-typed objects.</p>
<p>As a reminder, our <code>Configuration</code> property back in <code>startup.cs</code> is an instance of an <code>IConfiguration</code>, built from the <code>ConfigurationBuilder</code> in our constructor. It contains all the data that we've added in key-value pairs, and we can now use that object to expose the information we need through our IoC container when we're configuring our services.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span><span class="params">(IServiceCollection services)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    services.Configure&lt;AzureStorageSettings&gt;(Configuration.GetSection(<span class="string">"Data:Storage"</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other service configuration code here...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>What we have to do is call the <code>GetSection</code> method along with the corresponding path to where the object instance's properties will be loaded from. Our <code>Storage</code> information was in the <code>Data</code> property at the root of the document, so we pack it in as <code>Data:Storage</code> as the parameter to <code>GetSection</code>.</p>
<p>Now I've got configuration in my IoC container and I've got a class that represents the slice of configuration that I'm interested in. Now I want to mux those up and use it in my service (or controller or anything that is spun up with IoC). To do that I simply inject it into my constructor like so:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> QueueStorageService(IOptions&lt;AzureStorageSettings&gt; <span class="keyword">options</span>)</span><br><span class="line">&#123;</span><br><span class="line">    AzureStorageSettings settings = <span class="keyword">options</span>.<span class="keyword">Value</span>;</span><br><span class="line">    </span><br><span class="line">    // <span class="keyword">work</span> <span class="keyword">with</span> settings</span><br><span class="line">    var cloudStorageKey = <span class="keyword">options</span>.<span class="keyword">Value</span>.AzureStorage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>By simply accepting a parameter of type <code>IOptions&lt;AzureStorageSettings&gt;</code> in the constructor of my controller, the appropriate configuration elements are parsed out and provided to me in the <code>Value</code> property as an instance of my <code>AzureStorageSettings</code> class.</p>
<p>Note: You'll have to add a using statement to your controller or service for the <code>IOptions</code> interface:</p>
<pre><code>using Microsoft.Extensions.OptionsModel;
</code></pre>
<h2>Wrapping Up</h2>
<p>So to review, there are a couple of things we need to do:</p>
<ul>
<li>Create the configuration section</li>
<li>Create an object that corresponds to our configuration properties</li>
<li>Expose the settings class in our IoC container</li>
<li>Leverage <code>IOptions&lt;&gt;</code> to inject the settings into our constructor</li>
</ul>
<p>As you can see, this is a powerful and efficient way to create strongly-typed configuration objects in your ASP.NET Core MVC projects. It takes a minute to wrap your head around the pieces that are in play, but we can do away with the old method of custom configuration sections and simply represent our configuration data as JSON.</p>
<p>Happy coding!</p>

	        </div>

            
            <section id="comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
            </div>
            </section>
            
		</div>
	</div>
<!--MAIN CONTENT ENDS-->

<!--SIDEBAR CONTENT STARTS-->
	<div class="SubpageBoxSubSm">
		<div class="SubpageBoxSubSmContent">
			
			

			<div class="ProfileImg">
				
				<a href="/bios/james_chambers">
				
					<img src='https://www.gravatar.com/avatar/1ac8c631c34a86ddcfb6ae67f6a7a551?s=200' />
				
				</a>
				
			</div>

			<BR clear="all">

			<h2><a href="/bios/james_chambers">James Chambers</a></h2>
			
			<a href="mailto:james@jameschambers.com"><img class="ProfileIcon" src="/images/icon_email.png" border="0" alt="Email" title="Email"> Email</a><BR>
			
			
			<a href="http://jameschambers.com/" target="_blank"><img class="ProfileIcon" src="/images/icon_web.png" border="0" alt="Web" title="Web"> Web</a><BR>
			
			
			<a href="http://twitter.com/canadianjames" target="_blank"><img class="ProfileIcon" src="/images/icon_twitter.png" border="0" alt="Twitter" title="Twitter"> Twitter</a><BR>
			
			
			<a href="https://github.com/MisterJames" target="_blank"><img class="ProfileIcon" src="/images/icon_github.png" border="0" alt="GitHub" title="GitHub"> GitHub</a><br>
			
			
			<a href="https://www.linkedin.com/in/canadianjames" target="_blank"><img class="ProfileIcon" src="/images/icon_linkedin.png" border="0" alt="LinkedIN" title="LinkedIN"> LinkedIn</a><br>
			
			
 			<a href="/feeds/james_chambers.xml"><img class="ProfileIcon" src="/images/icon_subscribe.png" /> RSS</a>
			

			<hr />
			<h4>Looking for someone else?</h4>
			<p>You can find the rest of the Western Devs Crew <a href="/whoweare">here</a>.</p>
		</div>
	</div>
<!--SIDEBAR CONTENT ENDS-->


</div>
</center>
<!--PAGE CONTENT ENDS-->


<!--FOOTER STARTS-->
<center>
  <div class="FooterBarTxt">&copy; 2015 Western Devs. All Rights Reserved. Design by <a href="http://www.karenchudobiak.ca" target="_blank">Karen Chudobiak, Graphic Designer</a></div>
</center>
<!--FOOTER ENDS-->

<!-- NAV FOOTER STARTS -->
<div class="NavFooter">
  <a href="/posts" alt="Posts"><i class="fa fa-newspaper-o fa-2x"></i><span>Posts</span></a>
  <a href="/podcasts" alt="Podcasts"><i class="fa fa-volume-up fa-2x"></i><span>Podcasts</span></a>
  <a href="/whoweare" alt="About"><i class="fa fa-star fa-2x"></i><span>About</span></a>
  <a href="/whatwevedone" alt="What We've Done"><i class="fa fa-trophy fa-2x"></i><span>Work</span></a>
  <a href="/speaking" alt="Speaking"><i class="fa fa-comment-o fa-2x fa-flip-horizontal"></i><span>Speaking</span></a>
</div>
<!-- NAV FOOTER ENDS -->




</div>
<!--WRAPPER ENDS-->


<script>
  var disqus_shortname = 'westerndevs';
  
  var disqus_url = 'https://westerndevs.com/ASP-NET-Core/Strongly-Typed-Configuration-in-ASP-NET-Core-MVC/'.replace(".com//", ".com/");
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

</script>


</body>

  
<!-- Google Analytics -->
<script type="text/javascript">
if (document.location.hostname.search("westerndevs.com") !== -1 || document.location.hostname.search("www.westerndevs.com") !== -1) {
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37617956-2', 'auto');

ga('set', 'contentGroup1', 'james_chambers');

ga('send', 'pageview');
}
</script>
<!-- End Google Analytics -->



</html>
