<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Western Devs</title>
  
  <link href="/feeds/simon_timms" rel="self" type="application/atom+xml"/>
  <link href="https://westerndevs.com" rel="alternate" type="application/atom+xml"/>
  
  <updated>2022-11-01T12:58:25.109Z</updated>
  <id>https://westerndevs.com/</id>
  
  <author>
    <name>Western Devs</name>
	<uri>https://westerndevs.com</uri>
    <email>info@westerndevs.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title type="html">Dealing with Set-Output Depreciation Warnings in Terraform github-actions</title>
    <link href="https://westerndevs.com/_/set-output-terraform/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/set-output-terraform/</id>
    <published>2022-11-01T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.109Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>I've got a build that is running terraform on github actions (I actually have loads of them) and I've been noticing that they are very chatty about warnings now.</p><p><img src="/images/2022-11-01-set-output-terraform.md/2022-11-01-06-46-18.png" alt="">)</p><p>The warning is</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">The </span>`<span class="built_in">set-output`</span> <span class="string">command </span><span class="string">is </span><span class="string">deprecated </span><span class="string">and </span><span class="string">will </span><span class="string">be </span><span class="string">disabled </span><span class="string">soon.</span> <span class="string">Please </span><span class="string">upgrade </span><span class="string">to </span><span class="string">using </span><span class="string">Environment </span><span class="string">Files.</span> <span class="string">For </span><span class="string">more </span><span class="string">information </span><span class="string">see:</span> <span class="string">https:</span>//<span class="string">github.</span><span class="string">blog/</span><span class="string">changelog/</span><span class="string">2022-10-</span><span class="string">11-github-</span><span class="string">actions-deprecating-</span><span class="string">save-state-</span><span class="string">and-set-</span><span class="string">output-commands/</span></span><br></pre></td></tr></table></figure><p>The history here without reading that link is basically that github are changing how we push variables to the pipeline for use in later steps. There were some security implications with the old approach and the new approach should be better</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Save</span> <span class="string">variable</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">echo</span> <span class="string">"SOMENAME=PICKLE"</span> <span class="string">&gt;&gt;</span> <span class="string">$GITHUB_STATE</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">output</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">echo</span> <span class="string">"SOMENAME=PICKLE"</span> <span class="string">&gt;&gt;</span> <span class="string">$GITHUB_OUTPUT</span></span><br></pre></td></tr></table></figure><p>Problem was that the steps on which I was having trouble didn't obviously use the <code>set-output</code> command.</p>  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Init</span> <span class="string">Terraform</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">init</span> </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Validate</span> <span class="string">Terraform</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">validate</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>I had to dig a bit to find out that it was actually the <code>terraform</code> command that was causing the problem. See as part of the build I install the terraform cli using the</p>  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HashiCorp</span> <span class="bullet">-</span> <span class="string">Setup</span> <span class="string">Terraform</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">hashicorp/setup-terraform@v2.0.2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">      <span class="attr">terraform_version:</span> <span class="number">1.1</span><span class="number">.9</span></span><br><span class="line">      <span class="attr">terraform_wrapper:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>Turns out that as of writing the latest version of the wrapper installed by the setup-terraform task makes use of an older version of the <code>@actions/core</code> package. This package is what is used to set the output and before version 1.10 it did so using <code>set-output</code>. A fix has been merged into the setup-terraform project but no update released yet.</p><p>For now I found that I had no need for the wrapper so I disabled it with</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HashiCorp</span> <span class="bullet">-</span> <span class="string">Setup</span> <span class="string">Terraform</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">hashicorp/setup-terraform@v2.0.2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">      <span class="attr">terraform_version:</span> <span class="number">1.1</span><span class="number">.9</span></span><br><span class="line">      <span class="attr">terraform_wrapper:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>but for future readers if there is a more recent version of setup-terraform than 2.0.2 then you can update to that to remove the warnings. Now my build is clean</p><p><img src="/images/2022-11-01-set-output-terraform.md/2022-11-01-06-57-27.png" alt="">)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I&#39;ve got a build that is running terraform on github actions (I actually have loads of them) and I&#39;ve been noticing that they are very ch
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Registering Terraform Providers</title>
    <link href="https://westerndevs.com/_/register-providers/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/register-providers/</id>
    <published>2022-08-12T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.109Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>If you're setting up a new Terraform project on Azure you might find yourself needing to register providers if you're running with an identity that doesn't have wide ranging access to the subscription. I ran into this today with the error</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">│ Error: Error ensuring Resource Providers are registered.</span><br><span class="line">│ </span><br><span class="line">│ Terraform automatically attempts to register the Resource Providers it supports to</span><br><span class="line">│ ensure it's able to provision resources.</span><br><span class="line">│ </span><br><span class="line">│ If you don't have permission to register Resource Providers you may wish to <span class="keyword">use</span> the</span><br><span class="line">│ <span class="string">"skip_provider_registration"</span> flag <span class="keyword">in</span> the Provider <span class="keyword">block</span> <span class="keyword">to</span> <span class="keyword">disable</span> this functionality.</span><br><span class="line">│ </span><br><span class="line">│ Please note that <span class="keyword">if</span> you opt <span class="keyword">out</span> <span class="keyword">of</span> <span class="keyword">Resource</span> Provider Registration <span class="keyword">and</span> Terraform tries</span><br><span class="line">│ <span class="keyword">to</span> provision a <span class="keyword">resource</span> <span class="keyword">from</span> a <span class="keyword">Resource</span> Provider which <span class="keyword">is</span> unregistered, <span class="keyword">then</span> the <span class="keyword">errors</span></span><br><span class="line">│ may appear misleading - <span class="keyword">for</span> example:</span><br><span class="line">│ </span><br><span class="line">│ &gt; API <span class="keyword">version</span> <span class="number">2019</span>-XX-XX was <span class="keyword">not</span> <span class="keyword">found</span> <span class="keyword">for</span> Microsoft.Foo</span><br><span class="line">│ </span><br><span class="line">│ Could indicate either that the <span class="keyword">Resource</span> Provider <span class="string">"Microsoft.Foo"</span> requires registration,</span><br><span class="line">│ but this could also indicate that this Azure Region doesn<span class="string">'t support this API version.</span></span><br><span class="line"><span class="string">│ </span></span><br><span class="line"><span class="string">│ More information on the "skip_provider_registration" flag can be found here:</span></span><br><span class="line"><span class="string">│ https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs#skip_provider_registration</span></span><br><span class="line"><span class="string">│ </span></span><br><span class="line"><span class="string">│ Original Error: Cannnot register providers: Microsoft.StoragePool. Errors were: Cannot register provider Microsoft.StoragePool with Azure Resource Manager: resources.ProvidersClient#Register: Failure responding to request: StatusCode=403 -- Original Error: autorest/azure: Service returned an error. Status=403 Code="AuthorizationFailed" Message="The client '</span>************<span class="string">' with object id ''************'' does not have authorization to perform action '</span>Microsoft.StoragePool/<span class="keyword">register</span>/<span class="keyword">action</span><span class="string">' over scope '</span>/subscriptions<span class="comment">/***' or the scope is invalid. If access was recently granted, please refresh your credentials.".</span></span><br><span class="line"><span class="comment">│ </span></span><br><span class="line"><span class="comment">│   with provider["registry.terraform.io/hashicorp/azurerm"],</span></span><br><span class="line"><span class="comment">│   on environment.tf line 21, in provider "azurerm":</span></span><br><span class="line"><span class="comment">│   21: provider "azurerm" &#123;</span></span><br></pre></td></tr></table></figure><p>The account running terraform in my github actions pipeline is restricted to only have contributor over the resource group into which I'm deploying so it's unable to properly set up providers. Two things needed to fix it:</p><ol><li>Tell terraform to not try to register providers</li><li>Register the providers manually</li></ol><p>For 1 the provider block in the terraform file needs to be updated to look like</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attribute">provider</span> <span class="string">"azurerm"</span> &#123;</span><br><span class="line">    <span class="section">features</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">skip_provider_registration</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For 2 it requires logging into the azure portal and registering the providers manually. Go to the subscription and select <code>Resource Providers</code> then search for the one you need, select it and hit <code>Register</code>. In my case the provider was already registered and the problem was just Terraform's attempt to register it without sufficient permission.</p><p><img src="/images/2022-08-11-register_providers.md/2022-08-11-07-07-29.png" alt="">)</p><pre><code></code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;If you&#39;re setting up a new Terraform project on Azure you might find yourself needing to register providers if you&#39;re running with an ide
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Debugging Azure Container Instance Startup</title>
    <link href="https://westerndevs.com/_/debug-azure-container-instances-startup/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/debug-azure-container-instances-startup/</id>
    <published>2022-08-04T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>I have some container instances which are failing to start up properly and the logs in the portal are blank. This makes debugging them kind of difficult.</p><p>On the command line running</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az container logs -g &lt;resource group name&gt; -n &lt;container group name&gt; --container &lt;container name&gt;</span><br></pre></td></tr></table></figure><p>Just gave me an output of <code>None</code>. Not useful either.</p><p>Fortunately, you can attach directly to the logs streams coming out of the container which will give you a better idea of what is going on.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az container attach -g &lt;resource group name&gt; -n &lt;container group name&gt; --container &lt;container name&gt;</span><br></pre></td></tr></table></figure><p>This was able to give me output like</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Start</span> streaming <span class="keyword">logs</span>:</span><br><span class="line">/usr/<span class="keyword">local</span>/lib/python3<span class="number">.9</span>/site-packages/environ/environ.py:<span class="number">628</span>: UserWarning: /ric-api/core/.env doesn<span class="string">'t exist - if you'</span>re <span class="keyword">not</span> configuring your environment separately, <span class="keyword">create</span> one.</span><br><span class="line">  warnings.warn(</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/environ/environ.py"</span>, line <span class="number">273</span>, <span class="keyword">in</span> get_value</span><br><span class="line">    <span class="keyword">value</span> = self.ENVIRON[<span class="keyword">var</span>]</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/os.py"</span>, line <span class="number">679</span>, <span class="keyword">in</span> __getitem__</span><br><span class="line">    <span class="keyword">raise</span> KeyError(<span class="keyword">key</span>) <span class="keyword">from</span> <span class="keyword">None</span></span><br><span class="line">KeyError: <span class="string">'DB_PORT'</span></span><br><span class="line"></span><br><span class="line">During handling <span class="keyword">of</span> the above <span class="keyword">exception</span>, another <span class="keyword">exception</span> occurred:</span><br><span class="line"></span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/ric-api/manage.py"</span>, line <span class="number">22</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    <span class="keyword">main</span>()</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/ric-api/manage.py"</span>, line <span class="number">18</span>, <span class="keyword">in</span> <span class="keyword">main</span></span><br><span class="line">    execute_from_command_line(sys.argv)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/__init__.py"</span>, line <span class="number">419</span>, <span class="keyword">in</span> execute_from_command_line</span><br><span class="line">    utility.execute()</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/__init__.py"</span>, line <span class="number">413</span>, <span class="keyword">in</span> <span class="keyword">execute</span></span><br><span class="line">    self.fetch_command(subcommand).run_from_argv(self.argv)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/base.py"</span>, line <span class="number">354</span>, <span class="keyword">in</span> run_from_argv</span><br><span class="line">    self.execute(*args, **cmd_options)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="number">61</span>, <span class="keyword">in</span> <span class="keyword">execute</span></span><br><span class="line">    super().execute(*args, **options)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/base.py"</span>, line <span class="number">398</span>, <span class="keyword">in</span> <span class="keyword">execute</span></span><br><span class="line">    <span class="keyword">output</span> = self.handle(*args, **options)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/core/management/commands/runserver.py"</span>, line <span class="number">68</span>, <span class="keyword">in</span> handle</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> settings.DEBUG <span class="keyword">and</span> <span class="keyword">not</span> settings.ALLOWED_HOSTS:</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/conf/__init__.py"</span>, line <span class="number">82</span>, <span class="keyword">in</span> __getattr__</span><br><span class="line">    self._setup(<span class="keyword">name</span>)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/conf/__init__.py"</span>, line <span class="number">69</span>, <span class="keyword">in</span> _setup</span><br><span class="line">    self._wrapped = <span class="keyword">Settings</span>(settings_module)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/django/conf/__init__.py"</span>, line <span class="number">170</span>, <span class="keyword">in</span> __init__</span><br><span class="line">    <span class="keyword">mod</span> = importlib.import_module(self.SETTINGS_MODULE)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/importlib/__init__.py"</span>, line <span class="number">127</span>, <span class="keyword">in</span> import_module</span><br><span class="line">    <span class="keyword">return</span> _bootstrap._gcd_import(<span class="keyword">name</span>[<span class="keyword">level</span>:], <span class="keyword">package</span>, <span class="keyword">level</span>)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap&gt;"</span>, line <span class="number">1030</span>, <span class="keyword">in</span> _gcd_import</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap&gt;"</span>, line <span class="number">1007</span>, <span class="keyword">in</span> _find_and_load</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap&gt;"</span>, line <span class="number">986</span>, <span class="keyword">in</span> _find_and_load_unlocked</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap&gt;"</span>, line <span class="number">680</span>, <span class="keyword">in</span> _load_unlocked</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap_external&gt;"</span>, line <span class="number">850</span>, <span class="keyword">in</span> exec_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;frozen importlib._bootstrap&gt;"</span>, line <span class="number">228</span>, <span class="keyword">in</span> _call_with_frames_removed</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/ric-api/core/settings.py"</span>, line <span class="number">114</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    <span class="string">'PORT'</span>: env(<span class="string">'DB_PORT'</span>),</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/environ/environ.py"</span>, line <span class="number">123</span>, <span class="keyword">in</span> __call__</span><br><span class="line">    <span class="keyword">return</span> self.get_value(<span class="keyword">var</span>, <span class="keyword">cast</span>=<span class="keyword">cast</span>, <span class="keyword">default</span>=<span class="keyword">default</span>, parse_default=parse_default)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python3.9/site-packages/environ/environ.py"</span>, line <span class="number">277</span>, <span class="keyword">in</span> get_value</span><br><span class="line">    <span class="keyword">raise</span> ImproperlyConfigured(error_msg)</span><br><span class="line">django.core.exceptions.ImproperlyConfigured: <span class="keyword">Set</span> the DB_PORT environment <span class="keyword">variable</span></span><br><span class="line"><span class="number">2022</span><span class="number">-07</span><span class="number">-14</span>T14:<span class="number">37</span>:<span class="number">17.6003172</span>Z stderr F</span><br><span class="line"></span><br><span class="line"><span class="keyword">Exception</span> <span class="keyword">in</span> <span class="keyword">thread</span> <span class="keyword">Thread</span><span class="number">-1</span>:</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"threading.py"</span>, line <span class="number">932</span>, <span class="keyword">in</span> _bootstrap_inner</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"threading.py"</span>, line <span class="number">870</span>, <span class="keyword">in</span> run</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\a\1\s\build_scripts\windows\artifacts\cli\Lib\site-packages\azure/cli/command_modules/container/custom.py"</span>, line <span class="number">837</span>, <span class="keyword">in</span> _stream_container_events_and_logs</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\a\1\s\build_scripts\windows\artifacts\cli\Lib\site-packages\azure/cli/command_modules/container/custom.py"</span>, line <span class="number">791</span>, <span class="keyword">in</span> _stream_logs</span><br><span class="line">AttributeError: <span class="string">'NoneType'</span> <span class="keyword">object</span> has <span class="keyword">no</span> <span class="keyword">attribute</span> <span class="string">'split'</span></span><br></pre></td></tr></table></figure><p>Looks like I missed adding a <code>DB_PORT</code> to the environmental variables</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I have some container instances which are failing to start up properly and the logs in the portal are blank. This makes debugging them ki
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Consuming SOAP Services in .NET Core</title>
    <link href="https://westerndevs.com/_/consuming-wsdl/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/consuming-wsdl/</id>
    <published>2022-05-30T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>Today I ran into the need to consume an older SOAP web service in .NET Core. I was really fortunate in my timing because Core WCF was just released and it makes the whole process much easier.</p><p>Taking a step back for you youngsters out there SOAP was the service communication technology that existed before REST showed up with its JSON and ate everybody's lunch. SOAP is really just the name for the transport mechanism but I think most of us would refer to the whole method of invoking remote procedures over the web as <code>SOAP Web Services</code>. SOAP, or Simple Object Access Protocol, is an XML-based standard for serializing objects from various different languages in a way that Java could talk to .NET could talk to Python. Unlike JSON it was a pretty well thought out protocol and had standard representations of things like dates which JSON just kind of ignores.</p><p>Web services were closer to a remote method invocation in that you would call something like <code>GetUserId</code> rather than the RESTful approach of hitting an endpoint like <code>/Users/7</code> to get a user with Id 7. The endpoints which were provided by a Web Service were usually written down in a big long XML document called a WSDL which stands for Web Service Definition Language.</p><p>Web services gained a reputation for being very enterprisy and complex. There were a large number of additional standards defined around it which are commonly known as ws-*. These include such things as WS-Discovery, WS-Security, WS-Policy and, my personal favorite, the memorably named Web Single Sign-On Metadata Exchange Protocol.</p><h2>Core WCF</h2><p>In the last month we've seen the 1.0 release of <a href="https://devblogs.microsoft.com/dotnet/corewcf-v1-released/" target="_blank" rel="noopener">Core WCF</a> which I'm pretty certain I mocked at being a silly thing in which to invest resources. Tables have turned now I'm the one who needs it so thank to <a href="https://twitter.com/coolcsh" target="_blank" rel="noopener">Scott Hunter</a> or whoever it was that allocated resources to developing this.</p><p>To get started I needed to find the WSDLs for the services I wanted. This required a call to the support department of the company providing the services. The had a .NET library they pointed me to but it was compiled against .NET 4.5 so I wanted to refresh it. Fortunately the Core WCF release includes an updated <code>svcutil</code>. This tool will read a WSDL and generate service stubs in .NET for you.</p><p>I started with a new console project</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new console</span><br></pre></td></tr></table></figure><p>Then installed the dotnet-svcutil tool globally (you only need to do this once) and generated a service reference</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet tool install --global dotnet-svcutil</span><br><span class="line">dotnet-svcutil --roll-forward LatestMajor https://energydataservices.ihsenergy.com/services/v2/searchservice.svc</span><br></pre></td></tr></table></figure><p>This updated my project's csproj file to include a whole whack of new library references</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">OutputType</span>&gt;</span>Exe<span class="tag">&lt;/<span class="name">OutputType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>net6.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RootNamespace</span>&gt;</span>wsdl_test<span class="tag">&lt;/<span class="name">RootNamespace</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImplicitUsings</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">ImplicitUsings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Nullable</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">Nullable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DotNetCliToolReference</span> <span class="attr">Include</span>=<span class="string">"dotnet-svcutil"</span> <span class="attr">Version</span>=<span class="string">"1.0.*"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"CoreWCF.Http"</span> <span class="attr">Version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"CoreWCF.Primitives"</span> <span class="attr">Version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Reference</span> <span class="attr">Include</span>=<span class="string">"System.ServiceModel"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">HintPath</span>&gt;</span>System.ServiceModel<span class="tag">&lt;/<span class="name">HintPath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Reference</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"System.ServiceModel.Duplex"</span> <span class="attr">Version</span>=<span class="string">"4.8.*"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"System.ServiceModel.Http"</span> <span class="attr">Version</span>=<span class="string">"4.8.*"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"System.ServiceModel.NetTcp"</span> <span class="attr">Version</span>=<span class="string">"4.8.*"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"System.ServiceModel.Security"</span> <span class="attr">Version</span>=<span class="string">"4.8.*"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It also generated a 13 000 line long service reference file in the project. Wowzers. I'm glad I don't have to write that fellow myself.</p><p>With that all generated I'm now able to call methods in that service by just doing</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ServiceReference;</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> SearchServiceClient();</span><br><span class="line"><span class="keyword">var</span> result = <span class="keyword">await</span> client.SomeMethodAsync();</span><br></pre></td></tr></table></figure><p>This example really only scratches the surface of what the new Core WCF brings to .NET Core. I certainly wouldn't want to develop new WCF services but for consuming existing ones or even updating existing ones then this library is going to be a great boost to productivity.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Today I ran into the need to consume an older SOAP web service in .NET Core. I was really fortunate in my timing because Core WCF was jus
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Azure Functions Provider Error</title>
    <link href="https://westerndevs.com/_/azure-functions-error/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/azure-functions-error/</id>
    <published>2022-04-07T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>I started up a previously working Azure functions project today that I hadn't touched in a week. It failed to start with an error like this</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A host <span class="builtin-name">error</span> has occurred during startup operation <span class="string">'b59ba8b8-f264-4274-a9eb-e17ba0e02ed8'</span>.</span><br><span class="line">api: Could <span class="keyword">not</span> load file <span class="keyword">or</span> assembly <span class="string">'Microsoft.Extensions.Options, Version=6.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60'</span>. The<span class="built_in"> system </span>cannot <span class="builtin-name">find</span> the file specified.</span><br><span class="line">Value cannot be <span class="literal">null</span>. (Parameter <span class="string">'provider'</span>)</span><br></pre></td></tr></table></figure><p>This is the sort of error that terrifies me. Something is wrong but who knows what. No changes in git and an infinity of generic errors on google for <code>Could not load file or assembly</code>. Eventually after some digging it seems like I might be suffering from some corrupted tooling (some hints about that here: https://github.com/Azure/azure-functions-core-tools/issues/2232). I was able to fix mine by downloading the latest version of the tooling from https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=v4%2Cwindows%2Ccsharp%2Cportal%2Cbash</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I started up a previously working Azure functions project today that I hadn&#39;t touched in a week. It failed to start with an error like th
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Which SQL Hosting Option is Right for Me?</title>
    <link href="https://westerndevs.com/_/which-sql-server-edition/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/which-sql-server-edition/</id>
    <published>2022-04-07T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.109Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>There are a bunch of different ways to host SQL Server workloads on Azure. Answering some questions about how you use SQL server can help guide us to picking the right option for you.</p><p>The 3 options for hosting we're considering are</p><ol><li>SQL Azure - https://azure.microsoft.com/en-us/products/azure-sql/database/#overview</li><li>Azure SQL Managed Instance - https://azure.microsoft.com/en-us/products/azure-sql/managed-instance/</li><li>SQL Server on VM - https://azure.microsoft.com/en-us/services/virtual-machines/sql-server/#overview</li></ol><p>I've listed these in my order of preference. I'd rather push people to a more managed solution than a less managed one. There is a huge shortage of SQL server skills out there so if you can take a more managed approach then you're less likely to run into problems that require you finding an SQL expert. I frequently say to companies that they're not in the business of managing SQL server but in the business of building whatever widgets they build. Unless there is a real need don't waste company resources building custom solutions when you can buy a 90% solution off the shelf.</p><p>When I talk with companies about migrating their existing workloads to the cloud from on premise SQL servers I find myself asking these questions:</p><ol><li>Does your solution use cross database joins?</li><li>Does your solution make use of the SQL Agent to run jobs?</li><li>Does your solution use FILESTREAM to access files on disk?</li><li>Does your solution require fine tuning of availability groups?</li><li>Does your solution require SQL logins from <code>CERTIFICATE</code>, <code>ASYMMETRIC KEY</code> or <code>SID</code>?</li><li>Do you need to make use of a compatibility level below 100?</li><li>Do you need to make use of database mirroring?</li><li>Does your solution need to start and stop job scheduling?</li><li>Are you making use of SQL Server Reporting Services (SSRS)?</li><li>Are you using xp_cmdshell anywhere in your application (https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15)</li></ol><p>If the answer to any of the first 3 questions is <code>yes</code> then they can't easily use SQL Azure* and should set the baseline to a managed instance. If the answer to any of the rest of the questions is <code>yes</code> then they should set the baseline to a VM running a full on version of SQL Server. Only if the answer to all these questions is <code>no</code> is SQL Azure the best solution.</p><ul><li>Cross database joins and SQL Agent can be replaced by Elastic Query and Elastic Jobs but neither one is an easy drop in replacement so I typically don't bother directing people to them for time constrained migrations.</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;There are a bunch of different ways to host SQL Server workloads on Azure. Answering some questions about how you use SQL server can help
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Redis Cheat Sheet</title>
    <link href="https://westerndevs.com/_/cheat-sheet/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/cheat-sheet/</id>
    <published>2022-04-04T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<h2>Running in Docker</h2><p>Quickly get started with</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name somename -p <span class="number">6379</span>:<span class="number">6379</span> redis</span><br></pre></td></tr></table></figure><h2>Connection</h2><p>The simplest connection string is to use <code>localhost</code> which just connects to the localhost on port 6379.</p><h2>Querying</h2><p>Redis is a really simple server to which you can just telnet (or use the redis-cli) to run commands.</p><p><strong>List All Keys</strong></p><p>This might not be a great idea against a prod server with lots of keys</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">keys</span> *</span><br></pre></td></tr></table></figure><p><strong>Get key type</strong></p><p>Redis supports a bunch of different data primatives like a simple key value, a list, a hash, a zset, ... to find the type of a key use <code>type</code></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">HereForElizabethAnneSlovak</span></span><br><span class="line"><span class="type">+zset</span></span><br></pre></td></tr></table></figure><p><strong>Set key value</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> blah <span class="comment">7</span></span><br></pre></td></tr></table></figure><p>This works for updates too</p><p><strong>Get key value</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">get</span> blah</span><br></pre></td></tr></table></figure><p><strong>Get everything in a zset</strong></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE <span class="string">"id"</span> <span class="number">0</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure><p><strong>Count everything in a zset</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcount HereForjohnrufuscolginjr. -<span class="literal">inf</span> +<span class="literal">inf</span></span><br></pre></td></tr></table></figure><p><strong>Get the first thing in a zset</strong></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE <span class="string">"id"</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>Get everything in a set</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SMEMBERS HereFeedHashTags</span></span><br></pre></td></tr></table></figure><p><strong>Get the first member of a list</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LPOP somekey</span></span><br></pre></td></tr></table></figure><p><strong>Get the last member of a list</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">RPOP somekey</span></span><br></pre></td></tr></table></figure><p><strong>Get the contents of a hash</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HGETALL somekey</span></span><br></pre></td></tr></table></figure><p><strong>Clear out the whole database</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">FLUSHALL</span></span><br></pre></td></tr></table></figure><p><strong>Clear just the current db</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">FLUSHDB</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2&gt;Running in Docker&lt;/h2&gt;
&lt;p&gt;Quickly get started with&lt;/p&gt;
&lt;figure class=&quot;highlight angelscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Fixing VS Code Rubocop Issues</title>
    <link href="https://westerndevs.com/_/rubocop-issue/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/rubocop-issue/</id>
    <published>2022-03-18T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.109Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>I run this rubocop extension in my VS Code</p><p><img src="/images/2022-03-18-rubocop-issue.md/2022-03-18-10-15-48.png" alt="rubocop extension">)</p><p>Recently the project I was on did a Ruby update and my rubocop stopped working with an error like this</p><p><img src="/images/2022-03-18-rubocop-issue.md/2022-03-18-10-16-43.png" alt="Rubocop error">)</p><p>The issue here was that the rubocop in the project was newer than the globally installed rubocop so it was returning empty output. This extension doesn't look like it uses <code>rbenv</code> properly so I needed to globally update rubocop which I did with</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/rubocop -v  -&gt; 1.22.3</span><br><span class="line">sudo gem install rubocop</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/rubocop -v  -&gt; 1.26</span><br></pre></td></tr></table></figure><p>I still had some errors about missing rules and needed to also do</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install rubocop-rake</span><br><span class="line">sudo gem install rubocop-rails</span><br><span class="line">sudo gem install rubocop-performance</span><br></pre></td></tr></table></figure><p>Ideally I'd like this extension to use the rbenv version of ruby but this gets me sorted for now.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I run this rubocop extension in my VS Code&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2022-03-18-rubocop-issue.md/2022-03-18-10-15-48.png&quot; alt=&quot;rubocop ext
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Unsupported Architecture for fsevents with Oryx</title>
    <link href="https://westerndevs.com/_/fsevents-optional-dependencies/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/fsevents-optional-dependencies/</id>
    <published>2022-03-16T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>I updated the version of the lock file on a project the other day in the hopes it might restore a little bit more quickly. However for some steps in my build an older version of NPM was being used. This older version didn't have support for the new lock file version and while it is supposed to be compatible it seemed like optional dependencies like fsevents were causing a legit issue</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm WARN <span class="keyword">read</span>-shrinkwrap This <span class="keyword">version</span> of npm is compatible with lockfileVersion@1, but package-lock.json was generated <span class="keyword">for</span> lockfileVersion@2. I'll try to <span class="keyword">do</span> my best with it!</span><br><span class="line">npm <span class="keyword">ERR</span>! code EBADPLATFORM</span><br><span class="line">npm <span class="keyword">ERR</span>! notsup Unsupported platform <span class="keyword">for</span> fsevents@2.3.2: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"linux"</span>,<span class="string">"arch"</span>:<span class="string">"x64"</span>&#125;)</span><br><span class="line">npm <span class="keyword">ERR</span>! notsup Valid OS:    darwin</span><br><span class="line">npm <span class="keyword">ERR</span>! notsup Valid <span class="keyword">Arch</span>:  any</span><br><span class="line">npm <span class="keyword">ERR</span>! notsup Actual OS:   linux</span><br><span class="line">npm <span class="keyword">ERR</span>! notsup Actual <span class="keyword">Arch</span>: x64</span><br><span class="line"></span><br><span class="line">npm <span class="keyword">ERR</span>! A complete <span class="keyword">log</span> of this <span class="keyword">run</span> can be found <span class="keyword">in</span>:</span><br><span class="line">npm <span class="keyword">ERR</span>!     /root/.npm/_logs/2022-03-09T13_58_42_006Z-debug.<span class="keyword">log</span></span><br></pre></td></tr></table></figure><p>In theory these fsevent things should be warnings because they are optional dependencies. Updating the version of node used by Oryx, the build engine for Azure Static Web Apps, listens to the version of node defined in <code>package.config</code>. Adding this section to the <code>package.config</code> fixed everything</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"engines"</span>: &#123;</span><br><span class="line">    <span class="string">"node"</span>: <span class="string">"&gt;=16.0"</span>,</span><br><span class="line">    <span class="string">"npm"</span>: <span class="string">"&gt;=8.0"</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I updated the version of the lock file on a project the other day in the hopes it might restore a little bit more quickly. However for so
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Exclude node_modules from Backblaze Backups on Windows</title>
    <link href="https://westerndevs.com/_/backblaze-exclude-node-modules/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/backblaze-exclude-node-modules/</id>
    <published>2022-02-20T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>There are <a href="https://chrisblackwell.me/ignore-node_modules-and-git-folders-in-backblaze/" target="_blank" rel="noopener">some</a> <a href="https://gist.github.com/nickcernis/bb4bd43a44efd73b87d857e29b1d5b96" target="_blank" rel="noopener">articles</a> out there about how to exclude <code>node_modules</code> from Backblaze backups on OSX but I couldn't find anything about windows.</p><p>What you want to do is open up <code>C:\ProgramData\Backblaze\bzdata\bzexcluderules_editable.xml</code> and add a new rule.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">excludefname_rule</span> <span class="attr">plat</span>=<span class="string">"win"</span> <span class="attr">osVers</span>=<span class="string">"*"</span>  <span class="attr">ruleIsOptional</span>=<span class="string">"t"</span> <span class="attr">skipFirstCharThenStartsWith</span>=<span class="string">"*"</span> <span class="attr">contains_1</span>=<span class="string">"node_modules"</span> <span class="attr">contains_2</span>=<span class="string">"*"</span> <span class="attr">doesNotContain</span>=<span class="string">"*"</span> <span class="attr">endsWith</span>=<span class="string">"*"</span> <span class="attr">hasFileExtension</span>=<span class="string">"*"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>If you want to exclude .git folders too (they can also contain a lot of small files that are slow to backup) also add</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">excludefname_rule</span> <span class="attr">plat</span>=<span class="string">"win"</span> <span class="attr">osVers</span>=<span class="string">"*"</span>  <span class="attr">ruleIsOptional</span>=<span class="string">"t"</span> <span class="attr">skipFirstCharThenStartsWith</span>=<span class="string">"*"</span> <span class="attr">contains_1</span>=<span class="string">".git"</span> <span class="attr">contains_2</span>=<span class="string">"*"</span> <span class="attr">doesNotContain</span>=<span class="string">"*"</span> <span class="attr">endsWith</span>=<span class="string">"*"</span> <span class="attr">hasFileExtension</span>=<span class="string">"*"</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;There are &lt;a href=&quot;https://chrisblackwell.me/ignore-node_modules-and-git-folders-in-backblaze/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;some&lt;/a&gt; &lt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Parsing Vue Router Path Parameters</title>
    <link href="https://westerndevs.com/_/parsing-vue-router-parameters/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/parsing-vue-router-parameters/</id>
    <published>2022-02-18T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>In the vue router you can set up path parameters that are bound into the rendered component. For instance you might have a route like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/reports/:reportId/:reportName/:favorite'</span>,</span><br><span class="line">    name: <span class="string">'Reports'</span>,</span><br><span class="line">    component: ReportView,</span><br><span class="line">    props: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This will bind the parameters <code>reportId</code>, <code>reportName</code> and <code>favorite</code> on the component. However when you drop into that component and look at the values passed in you will see that they are strings. Of course that makes sense, the router doesn't really know if the things you pass in are strings or something else. Consider the route <code>/reports/17/awesome report/false</code>. Here <code>reportId</code> and <code>favorite</code> are going to be strings.</p><p>You can work around that by giving props in the router a function rather than just a boolean.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/reports/:reportId/:reportName/:favorite'</span>,</span><br><span class="line">    name: <span class="string">'Reports'</span>,</span><br><span class="line">    component: ReportView,</span><br><span class="line">    props: <span class="function">(<span class="params">route</span>) =&gt;</span> (&#123;</span><br><span class="line">      ...route.params,</span><br><span class="line">      reportId: <span class="built_in">parseInt</span>(route.params.reportId),</span><br><span class="line">      favorite: route.params.favorite === <span class="string">'true'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;In the vue router you can set up path parameters that are bound into the rendered component. For instance you might have a route like thi
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Installing the AzFilesHybrid PowerShell Module</title>
    <link href="https://westerndevs.com/_/install-azfileshybrid-powershell/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/install-azfileshybrid-powershell/</id>
    <published>2022-02-16T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>If you don't do a lot of powershell then the instructions on how to install the AzFilesHybrid module can be lacking. Here is how to do it</p><ol><li>Download the module from https://github.com/Azure-Samples/azure-files-samples/releases</li><li>Unzip the file downloaded in step 1</li><li>Go into the folder and run the copy command</li></ol><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./<span class="module-access"><span class="module"><span class="identifier">CopyToPSPath</span>.</span></span>ps1</span><br></pre></td></tr></table></figure><ol start="4"><li>Install the module with</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Install</span>-<span class="keyword">Module</span> -<span class="keyword">Name</span> AzFilesHybrid -<span class="keyword">Force</span></span><br></pre></td></tr></table></figure><p>With this module installed you can then run things like Join-AzStorageAccount to get a fileshare joined to the domain</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Join-AzStorageAccount -ResourceGroupName <span class="string">"rg-azfileshare"</span> -StorageAccountName <span class="string">"sa-azfileshare"</span> -<span class="built_in">DomainName</span> <span class="string">"somedomain.com"</span> -DomainUserName <span class="string">"jane"</span> -DomainUserPassword <span class="string">"password"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;If you don&#39;t do a lot of powershell then the instructions on how to install the AzFilesHybrid module can be lacking. Here is how to do it
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Purge CDN in DevOps</title>
    <link href="https://westerndevs.com/_/purge-cdn-in-devops/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/purge-cdn-in-devops/</id>
    <published>2022-01-27T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.109Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>In order to purge a cache in the build pipeline you can use some random task that some dude wrote or you can just use the Azure CLI.</p><p>Here is an example of what it would look like to purge the entire CDN top to bottom</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">task:</span> <span class="string">AzureCLI@2</span></span><br><span class="line">  <span class="attr">displayName:</span> <span class="string">'Invalidate CDN Cache'</span></span><br><span class="line">  <span class="attr">inputs:</span></span><br><span class="line">    <span class="attr">azureSubscription:</span> <span class="string">'Azure'</span></span><br><span class="line">    <span class="attr">scriptType:</span> <span class="string">'batch'</span></span><br><span class="line">    <span class="attr">scriptLocation:</span> <span class="string">'inlineScript'</span></span><br><span class="line">    <span class="attr">inlineScript:</span> <span class="string">'az cdn endpoint purge --content-paths "/*"  -n devascacdnendpoint -g devasca-rg --no-wait --profile-name devascacdn'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;In order to purge a cache in the build pipeline you can use some random task that some dude wrote or you can just use the Azure CLI.&lt;/p&gt;

    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Handling Nil in Nested Hashes in Ruby</title>
    <link href="https://westerndevs.com/_/hash-nil/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/hash-nil/</id>
    <published>2021-11-24T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>Tony Hoare introduced Null in ALGOL W in 1965. He says that it was a billion dollar mistake. Fortunately, Ruby totally avoids this sticky problem by renaming <code>null</code> to <code>nil</code>. This is the same strategy that my kids use when I say &quot;next person to ask for popcorn is going to do pushups&quot; and they ask for &quot;corn that has been popped&quot;. If you're navigating a nested hash, that is a hash that contains other hashes then you might get into a situation where you want to do something like</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">best_dessert = meals[:dinner][:dessert].<span class="built_in">find</span>&#123; | dessert | &#123;<span class="built_in">name</span>: dessert.<span class="built_in">name</span>, <span class="built_in">rating</span>: dessert.<span class="built_in">rating</span> &#125; &#125;.sort_by&#123; |a,b| b[:<span class="built_in">rating</span>] &#125;.first</span><br></pre></td></tr></table></figure><p>There are a bunch of opportunities in there for nil to creep in. Maybe there are no dinners maybe no desserts... to handle these we can use a combination of <code>dig</code> (which searches a path in a hash and returns nil if the path doesn't exist) and the safe navigation <code>&amp;.</code> operator.</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">best_dessert = meals.dig(:dinner, :dessert)&amp;.<span class="built_in">find</span>&#123; | dessert | &#123;<span class="built_in">name</span>: dessert.<span class="built_in">name</span>, <span class="built_in">rating</span>: dessert.<span class="built_in">rating</span> &#125; &#125;&amp;.sort_by&#123; |a,b| b[:<span class="built_in">rating</span>] &#125;&amp;.first</span><br></pre></td></tr></table></figure><p>This combination of dig and &amp;. allows us to get a nil out if nil appears anywhere in the chain without ending up in an error. We are calling the combination of dig and &amp;. the 811 operator after https://call811.com/</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Tony Hoare introduced Null in ALGOL W in 1965. He says that it was a billion dollar mistake. Fortunately, Ruby totally avoids this sticky
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Choosing Power BI</title>
    <link href="https://westerndevs.com/_/choosing-power-bi/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/choosing-power-bi/</id>
    <published>2021-11-19T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>If you're a developer and you're looking for a solution for reporting in your application then Power BI might be the right choice for you. However, there are tradeoffs that are worth considering before you dig in too much.</p><h2>What is it?</h2><p>The GitHub copilot I have running while writing this wants me to say that &quot;Power BI is a platform for creating and managing data-driven reports. It's a powerful tool that allows you to create reports that are easy to understand and use.&quot; That sounds an awful lot like a sentence that an AI trained on Microsoft marketing data would say. It isn't entirely inaccurate. For me Power BI is a combination for two different reporting tools which are pretty different from one another. The first is the one you see in all the marketing literature: Dashboard reports. These are nifty looking reports that are largely driven by visuals like maps or charts. Users can easily drill into aspects of the data by clicking on the charts or tables to filter the data and drill in. These reports aren't great for people who like to see the underlying data and draw their own conclusions.</p><p>The second report type is Paginated Reports. These reports are basically a complete migration of the older SQL Server Reporting Services (SSRS) reports. There is limited support for cool graphics but if you need an Excel like view of the data then they are great. I've run into a few cases in the past where I've tried to convince users that they cannot possibly want a 90 page report and that they should use the dashboard report. But frequently users do legitimately want to print 90 pages and go at the report with a highlighter. One of my favorite sayings for these situations is that as a developer I make suggestions and users make decisions.</p><p>The desktop based tools for building these reports are all pretty good. The dashboard report tool in particular is excellent. It may be that your users don't need to use online reporting and that providing them with a database connection and a copy of Power BI Desktop will be a good solution. The added advantage there is that the desktop tools are free to use. If you have a read only replica of your database then letting users develop their own reports doesn't have much of a downside other than having to support people as they learn the system. A cool idea is to build projections or views inside your database to handle the complex joins in your data and remove that burden from the users.</p><p>If you want to embed the reports in your application there is facility for doing that through a JavaScript API. You do need to jump through some hoops to authenticate and generate tokens but that's a lot easier than developing your own HTML based reports. There aren't a whole lot of examples out there for how to do embeddeding and you will need to spend some time learning the security models.</p><p>The alternative to all this is to use one of the myriad of other reporting tools that are available. I've used Telerik Reporting quite a lot in the past and I can confidently say it is &quot;not terrible&quot;. That's about as high of praise as you're going to get from me for a reporting tool.</p><h2>Cost</h2><p>As with anything Microsoft the pricing for all this is convoluted and contently changing. This is my current understanding of it but  you can likely get a better deal and understanding by talking to your sales representative.</p><ul><li>Power BI Desktop: Free as in beer</li><li>Power BI Pro: Let's you run dashboard reports online and embed them in your application (note that this doesn't' let you embed paginated reports) $9.99/month a users</li><li>Power BI Premium per user: This lets you run dashboard reports online and embed them in your application and also run paginated reports (note I didn't say embed paginated reports) $20/month a user</li><li>Power BI Premium per capacity: Run and embed both report types. Open for as many users as you have. $4995/month. Yikes, that price sure jumps up</li></ul><p>Being able to embed paginated reports was the killer feature for me that took the reporting cost from very reasonable to very expensive.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;If you&#39;re a developer and you&#39;re looking for a solution for reporting in your application then Power BI might be the right choice for you
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">App Services on VNET</title>
    <link href="https://westerndevs.com/_/app-services-on-vnet/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/app-services-on-vnet/</id>
    <published>2021-11-14T05:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>When setting up an app service, including azure functions,  you can have it reside on a vnet so it can access internal resources like a database. Often time though you'll run into some problems routing to the database, specifically because of DNS. There are some good tools for debugging the connection.</p><p>First off you'll need to open a console to the app service. I do this using the kudu tools but I think the console exposed directly on the portal works too. The standard tools can't run in the restricted environment provided. However there are a couple of tools you can use in their place.</p><p>NSLookup - &gt; nameresolver.exe - run it with <code>nameresolver.exe blah.com</code>ping -&gt; tcpping.exe - run it with <code>tcpping.exe blah.com:80</code></p><p>If you're seeing DNS issues you can override the DNS server with the variables <code>WEBSITE_DNS_SERVER</code> and <code>WEBSITE_DNS_ALT_SERVER</code>. These two are entered in the app service config settings</p><p>One of the most typical problems I've encountered is that the app service isn't routing requests properly unless you add the app setting <code>WEBSITE_VNET_ROUTE_ALL=1</code>.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;When setting up an app service, including azure functions,  you can have it reside on a vnet so it can access internal resources like a d
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Using ngrok for ASP.NET</title>
    <link href="https://westerndevs.com/_/ngrok-aspnet/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/ngrok-aspnet/</id>
    <published>2021-10-25T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>If you try to just use ngrok like this</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngrok http <span class="number">1316</span></span><br></pre></td></tr></table></figure><p>You're likely going to run into an issue when you browse to the website via the ngrok supplied URL that there are invalid host headers. This is because the local server is expecting headers for <code>localhost</code> and instead it is getting them for something like <code>https://3fe1-198-53-125-218.ngrok.io</code>. This can be solved by running with</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngrok <span class="keyword">http</span> <span class="number">1316</span> -host-header=<span class="string">"localhost:1316"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;If you try to just use ngrok like this&lt;/p&gt;
&lt;figure class=&quot;highlight angelscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Reading a TSV file in Pandas</title>
    <link href="https://westerndevs.com/_/pandas-read-tsv/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/pandas-read-tsv/</id>
    <published>2021-10-25T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>Pretty easy, just use the csv loader with a different record separator</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read<span class="constructor">_csv('<span class="params">work</span><span class="operator">/</span><span class="params">data</span>.<span class="params">tsv</span>', <span class="params">sep</span>='\<span class="params">t</span>')</span></span><br></pre></td></tr></table></figure><p>You can tell it explicitly to use the first column as the header</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read<span class="constructor">_csv('<span class="params">work</span><span class="operator">/</span><span class="params">data</span>.<span class="params">tsv</span>', <span class="params">sep</span>='\<span class="params">t</span>', <span class="params">header</span>=0)</span></span><br></pre></td></tr></table></figure><p>I also found that it interpreted my first column as an index which I didn't want (it offset all the columns by one)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">'work/data.tsv'</span>, <span class="attribute">sep</span>=<span class="string">'\t'</span>, <span class="attribute">header</span>=0, <span class="attribute">index_col</span>=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Pretty easy, just use the csv loader with a different record separator&lt;/p&gt;
&lt;figure class=&quot;highlight reasonml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutte
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Using RLS in Power BI Embedded</title>
    <link href="https://westerndevs.com/_/RLS-with-power-bi/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/RLS-with-power-bi/</id>
    <published>2021-10-22T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.101Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>Power BI is a funny animal. On some levels it is a logical successor to SSRS but on other levels it is a totally different beast. One of the ways it differs greatly from SSRS is in handling parameters, especially secure parameters. When embedding an SSRS report you could specify the parameter value in a secure fashion and then now show the selector to end users.</p><p>In many cases there is a need to use row level security (RLS) to restrict the data that a user can see in Power BI. There are a myriad of ways to do this wrong and I think I've explored most of them over the last few days. There is also at least one way that works.</p><p>A tempting approach is to use a filter. These can be applied at render time in the browser by adding to the config when embedding the report.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">      visualName: <span class="string">''</span>,</span><br><span class="line">      type: <span class="string">'report'</span>,</span><br><span class="line">      accessToken: token, </span><br><span class="line">      embedUrl: token.embedUrl,</span><br><span class="line">      tokenType: powerbi.models.TokenType.Embed,</span><br><span class="line">      permissions: permissions,</span><br><span class="line">      <span class="comment">// 👇 filters</span></span><br><span class="line">      filters: [</span><br><span class="line">        &#123;</span><br><span class="line">          $schema: <span class="string">"http://powerbi.com/product/schema#basic"</span>,</span><br><span class="line">          target: &#123;</span><br><span class="line">              table: <span class="string">"monthlyProducts"</span>,</span><br><span class="line">              column: <span class="string">"userId"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          operator: <span class="string">"In"</span>,</span><br><span class="line">          values: [<span class="string">"stimms"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// ☝️</span></span><br><span class="line">      settings: &#123;</span><br><span class="line">        panes: &#123;</span><br><span class="line">          filters: &#123;</span><br><span class="line">            visible: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          pageNavigation: &#123;</span><br><span class="line">            visible: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>This class of parameter is fine for providing filters that can be updated later by the user. However, it should not be used for parameters that require some degree of security like a user name. These parameters are easily changed and, unless your parameter are in some way cryptographically secure there is a good chance you're introducing a broken access control - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" target="_blank" rel="noopener">#1</a> on the <a href="https://owasp.org/www-project-top-ten/" target="_blank" rel="noopener">OWASP top 10</a>.</p><p>Instead of this approach you can use the manage roles functionality in Power BI.</p><p><img src="/images/2021-10-22-RLS_with_power_bi.md/2021-10-22-15-55-31.png" alt="">)</p><p>This functionality is designed to provide high level filters for data. A lot of the examples I see are for things like restricting a user in the <code>East</code> region from seeing the data of a user in the <code>West</code> region. This is done by assigning a role to that user when generating the embedding token. Then you'd set up a role for each region (see 1) and apply a filter expression to your tables so the only records with a region of <code>East</code> would show up.</p><p><img src="/images/2021-10-22-RLS_with_power_bi.md/2021-10-22-15-59-46.png" alt="">)</p><p>This is a simplistic and somewhat tiresome approach to adding a role mapping. What if a new region like <code>SouthEast</code> is introduced? What isn't, perhaps, as clear is that DAX expression can contain dynamic functions like <code>UserName()</code> which make filtering more powerful. This <code>UserName()</code> will be bound to the effective identity passed in</p><p><img src="/images/2022-07-06-RLS_with_power_bi.md/2022-07-06-07-11-52.png" alt="">)</p><p>What I settled on for my filtering was to have a single role which I enforce at the embedded token generation level and then filter my data by the UserName() which I also set at the embedded token level. Because these are set at the embedded token generation time which occurs on the server I can be confident that I'm not providing a way for somebody to view data they shouldn't.</p><p>The code for generation looks like this:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tokenRequest = <span class="keyword">new</span> GenerateTokenRequestV2(</span><br><span class="line">                    reports: <span class="keyword">new</span> List&lt;GenerateTokenRequestV2Report&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">new</span> GenerateTokenRequestV2Report(reportId)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    datasets: <span class="keyword">new</span> List&lt;GenerateTokenRequestV2Dataset&gt; &#123; <span class="keyword">new</span> GenerateTokenRequestV2Dataset(report.DatasetId) &#125;,</span><br><span class="line">                    identities: <span class="keyword">new</span> List&lt;EffectiveIdentity&gt; &#123; <span class="keyword">new</span> EffectiveIdentity(user.ContactId.ToString(),</span><br><span class="line">                                                                roles: <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt; &#123; <span class="string">"Users"</span> &#125;,</span><br><span class="line">                                                                datasets: <span class="keyword">new</span> List&lt;String&gt;&#123;report.DatasetId &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line"><span class="keyword">var</span> embedToken = <span class="keyword">await</span> client.EmbedToken.GenerateTokenAsync(tokenRequest);</span><br></pre></td></tr></table></figure><p>In this particular case the data I was returning from the database could be accessed by a number of different people depending on to which group they belonged. Initially I tried crossing the data against the user/group matrix but the cardinality of the resulting set was in the billions and totally overwhelmed both SQL Server and Power BI. Instead what I did was pull in the user/group matrix and the dataset that exposed the group id. In Power BI I did a merge of the datasets along with applying the row level filtering. This was necessary because, as far as I know, there is no way to pass the user name down to the actual query running against the server.</p><p>With all this in place I got good security and good performance. But, wow, did it take me a long time to get there.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Power BI is a funny animal. On some levels it is a logical successor to SSRS but on other levels it is a totally different beast. One of 
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title type="html">Mathplotlib cheat sheet</title>
    <link href="https://westerndevs.com/_/matplotlib-cheat-sheet/" rel="alternate" type="text/html"/>
    <id>https://westerndevs.com/_/matplotlib-cheat-sheet/</id>
    <published>2021-10-22T04:00:00.000Z</published>
    <updated>2022-11-01T12:58:25.105Z</updated>
	<author>
	
	  
	  <name>Simon Timms</name>
	  <email>stimms@gmail.com</email>
	
	  <uri>https://westerndevs.com</uri>
	</author>
    
    <content type="html"><![CDATA[<p>Part of an evolving cheat sheet</p><h2>Include the library</h2><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure><h2>Set the plot size to be larger</h2><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = [<span class="number">30</span>, <span class="number">21</span>]</span><br></pre></td></tr></table></figure><h2>Set plot title</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.<span class="built_in">title</span>("some <span class="built_in">title</span>)</span><br></pre></td></tr></table></figure><h2>Plot a line chart</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(filtered[<span class="string">'datetime'</span>], filtered[<span class="string">'totalsales'</span>], <span class="keyword">label</span><span class="bash">=<span class="string">"Sales Ingest"</span>)</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2>Add Legend</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">plt</span><span class="selector-class">.legend</span>()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Part of an evolving cheat sheet&lt;/p&gt;
&lt;h2&gt;Include the library&lt;/h2&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c
    
    </summary>
    
    
  </entry>
  
</feed>
